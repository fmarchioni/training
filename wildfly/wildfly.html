<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Title Slide</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.1.2/dist/reset.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.1.2/dist/reveal.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.1.2/dist/theme/solarized.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* source blocks */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* auto-animate feature */
/* hide the scrollbar when auto-animating source blocks */
.reveal pre[data-auto-animate-target] {
  overflow: hidden;
}

.reveal pre[data-auto-animate-target] code {
  overflow: hidden;
}

/* add a min width to avoid horizontal shift on line numbers */
code.hljs .hljs-ln-line.hljs-ln-n {
  min-width: 1.25em;
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}

.byline {
  font-size:.8em
}
ul.byline {
  list-style-type: none;
}
ul.byline li + li {
  margin-top: 0.25em;
}
</style><link rel="stylesheet" href="mycss.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Title Slide</h1><div class="preamble"><div class="paragraph"><p><a href="#_capitolo_8_configurazione_del_server_web_undertow">[_capitolo_8_configurazione_del_server_web_undertow]</a></p></div></div></section>
<section id="_cosa_è_wildfly"><h2>Cosa è WildFly?</h2><div class="slide-content"><div class="ulist"><ul><li><p>WildFly è un Application Server open source sviluppato da Red Hat.</p></li><li><p>Ambiente di runtime per applicazioni Java EE e Jakarta EE.</p></li><li><p>Provider di servizi applicativi, di sicurezza e con funzionalità di clustering.</p></li><li><p>WildFly deriva del progetto JBoss Application Server.</p></li></ul></div></div></section>
<section id="_installazione_di_wildfly"><h2>Installazione di WildFly</h2><div class="slide-content"><div class="ulist"><ul><li><p>Diverse opzioni</p><div class="ulist"><ul><li><p>Download dei binari</p></li><li><p>Build dei sorgenti da GitHub</p></li><li><p>Avvio come immagine Docker</p></li><li><p>Tools di provisioning (Ansible, Galleon)</p></li></ul></div></li></ul></div></div></section>
<section id="_download_binari"><h2>Download Binari</h2><div class="slide-content"><div class="ulist"><ul><li><p>Binari disponibili su: <a href="https://www.wildfly.org/downloads/" class="bare">https://www.wildfly.org/downloads/</a></p></li></ul></div>
<div class="imageblock"><img src="images/corso-download.png" alt="corso download"></div></div></section>
<section id="_wildfly_file_system" class="columns"><h2>WildFly File System</h2><div class="slide-content"><div class="listingblock small column is-three-quarters"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">├── appclient
│   └── configuration
├── bin
│   ├── scripts  <b>(1)</b>
├── docs <b>(2)</b>
├── domain <b>(3)</b>
│   ├── configuration
│   └── tmp
├── standalone <b>(4)</b>
│   ├── configuration
│   ├── data
│   ├── deployments
│   ├── lib
│   ├── log
│   └── tmp
├── modules <b>(5)</b></code></pre></div></div>
<div class="colist arabic small column fragment"><ol><li><p>Scripts avvio e Command Line tools</p></li><li><p>Schemi configurazione</p></li><li><p>Configurazione Dominio</p></li><li><p>Configurazione Standalone</p></li><li><p>Moduli</p></li></ol></div></div></section>
<section id="_wildfly_start_up"><h2>WildFly start up</h2><div class="slide-content"><div class="ulist"><ul><li><p>Gli script di avvio di WildFly sono nella cartella <code>bin</code> dell' Application Server</p></li><li><p>Per avviare in modalità Standalone:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ ./standalone.sh</code></pre></div></div></div></section>
<section id="_impostare_jboss_home"><h2>Impostare JBOSS_HOME</h2><div class="slide-content"><div class="ulist"><ul><li><p>JBOSS_HOME è una variabile d&#8217;ambiente che indica la directory di installazione di WildFly.</p></li><li><p>Se impostata farà override del PATH corrente dove siete posizionati</p></li><li><p>Assicurarsi che JBOSS_HOME punti alla directory principale di WildFly.</p></li><li><p>È possibile impostare questa variabile a livello di sistema o per la sessione corrente.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">export JBOSS_HOME=/home/jboss/wildfly-30.0.0.Final</code></pre></div></div></div></section>
<section id="_creare_un_utente_amministratore"><h2>Creare un utente amministratore</h2><div class="slide-content"><div class="ulist"><ul><li><p>Creare un utente amministratore è fondamentale per la gestione di WildFly.</p></li><li><p>Gli utenti amministratori hanno privilegi per la gestione e il monitoraggio del server.</p></li><li><p>L&#8217;utente amministratore di solito viene creato utilizzando gli script di gestione di WildFly.</p></li><li><p>Assicurarsi di assegnare ruoli appropriati all&#8217;utente amministratore.</p></li></ul></div></div></section>
<section id="_add_user_sh_add_user_bat"><h2>add-user.sh / add-user.bat</h2><div class="slide-content"><div class="ulist"><ul><li><p>Lo script <code>add-user</code> presente nella cartella <code>bin</code> consente di aggiungere utenti</p></li><li><p>Può aggiungere utenti Amministrativi o Applicativi:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ ./add-user.sh

What type of user do you wish to add?
 a) Management User (mgmt-users.properties)
 b) Application User (application-users.properties)
(a):</code></pre></div></div></div></section>
<section id="_creazione_di_un_utente_in_modalità_non_interattiva"><h2>Creazione di un utente in modalità non interattiva</h2><div class="slide-content"><div class="ulist"><ul><li><p>In alcuni casi, è possibile creare un utente in modalità non interattiva utilizzando script o comandi.</p></li><li><p>Questa modalità consente di automatizzare la creazione di utenti.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Management User
$ ./add-user.sh -m -u administrator1 -p password1!
# Application User
$ ./add-user.sh -a -u applicationuser1 -p password1! -g guest</code></pre></div></div></div></section>
<section id="_stopping_wildfly"><h2>Stopping WildFly</h2><div class="slide-content"><div class="ulist"><ul><li><p>L&#8217;arresto di WildFly può essere eseguito utilizzando script o comandi specifici.</p></li><li><p>È importante assicurarsi che tutte le applicazioni siano state arrestate in modo sicuro prima dell&#8217;arresto del server.</p></li><li><p>Il corretto arresto di WildFly contribuisce a evitare la perdita di dati e a mantenere l&#8217;integrità del sistema.</p></li><li><p>Verificare i log e i messaggi di stato durante la procedura di arresto.</p></li></ul></div></div></section>
<section id="_stopping_wildfly_2"><h2>Stopping WildFly</h2><div class="slide-content"><div class="ulist"><ul><li><p>Il processo Java di WildFly verrà interrotto dai comuni comandi OS (es. <code>kill -9</code>)</p></li><li><p>Il modo raccomandato per eseguire lo shutdown è tramite la Command Line Interface</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[standalone@localhost:9990 /] :shutdown
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}</code></pre></div></div></div></section>
<section id="_stopping_wildfly_da_un_host_remoto"><h2>Stopping WildFly da un host remoto</h2><div class="slide-content"><div class="ulist"><ul><li><p>Utilizzando gli strumenti di Management (Web Console o CLI) è possibile fare uno shutdown remoto</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[standalone@192.168.10.1:9990 /] :shutdown
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}</code></pre></div></div></div></section>
<section id="_problemi_comuni_allavvio"><h2>Problemi comuni all&#8217;avvio</h2><div class="slide-content"><div class="ulist"><ul><li><p>Esiste già una applicazione che utilizza le porte di WildFly:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">fuser -v -n tcp 8080
PORT      USER          PID          ACCESS COMMAND
8080/tcp: tomcat        7148        F.... java</code></pre></div></div>
<div class="ulist"><ul><li><p>Errori nel file di configurazione:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">OPVDX001: Validation error in standalone.xml -------------------------------
|  34: &lt;management&gt;
|  35:     &lt;security-realms&gt;xx
|  36:         &lt;security-realm name="ManagementRealm"&gt;
|             ^^^^ Received non-all-whitespace CHARACTERS or CDATA event in nextTag()</code></pre></div></div></div></section>
<section id="_installare_wildfly_come_servizio"><h2>Installare WildFly come servizio</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consente di avviare WildFly all&#8217;avvio del sistema operativo</p></li><li><p>Gestione Centralizzata con altri Servizi del sistema operativo</p></li><li><p>Sono già disponibili gli script batch per Linux/Windows</p></li></ul></div></div></section>
<section id="_installare_wildfly_come_servizio_su_linux"><h2>Installare WildFly come servizio su Linux</h2><div class="slide-content"><div class="ulist"><ul><li><p>Utilizzo init.d daemon</p><div class="ulist"><ul><li><p>Mediante scripts in <code>$JBOSS_HOME/docs/contrib/scripts/init.d</code></p></li></ul></div></li><li><p>Utilizzo systemd daemon</p><div class="ulist"><ul><li><p>Copia scripts in <code>$JBOSS_HOME/docs/contrib/scripts/systemd</code> nelle cartelle di <code>/etc</code></p></li></ul></div></li></ul></div></div></section>
<section id="_installare_wildfly_come_servizio_su_windows"><h2>Installare WildFly come servizio su Windows</h2><div class="slide-content"><div class="ulist"><ul><li><p>Scripts disponibili in <code>$JBOSS_HOME/docs/contrib/scripts/service</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">service install</code></pre></div></div></div></section>
<section id="_collegarsi_con_la_command_line_interface"><h2>Collegarsi con la Command Line Interface</h2><div class="slide-content"><div class="ulist"><ul><li><p>Posizionarsi nella cartella <code>$JBOSS_HOME/bin</code></p></li><li><p>Eseguire lo script <code>jboss-cli.sh</code> (Linux) oppure <code>jboss-cli.bat</code></p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ ./jboss-cli.sh

You are disconnected at the moment. Type ‘connect' to connect to the
server or ‘help' for the list of supported commands.
[disconnected /] connect</code></pre></div></div></div></section>
<section id="_configurazione_application_server"><h2>Configurazione Application Server</h2></section>
<section id="_le_due_modalità_del_server_disponibili"><h2>Le due modalità del server disponibili</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Standalone</strong>: Utilizzato per singole istanze di server. Ogni istanza ha la propria configurazione e servizi.</p></li><li><p><strong>Domain</strong>: Utilizzato per la gestione centralizzata di più istanze server. Condividono una configurazione comune e possono essere gestite insieme.</p></li></ul></div></div></section>
<section id="_il_file_di_configurazione_di_wildfly"><h2>Il file di configurazione di WildFly</h2><div class="slide-content"><div class="ulist"><ul><li><p>Il file di configurazione di default è denominato <code>standalone.xml</code> o <code>domain.xml</code>.</p></li><li><p>Incluso nella directory di configurazione di WildFly.</p></li><li><p>Puoi utilizzare un file non default mediante il parametro <code>-c</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ ./standalone.sh -c standalone-ha.xml</code></pre></div></div></div></section>
<section id="_extensions"><h2>Extensions</h2><div class="slide-content"><div class="ulist"><ul><li><p>Forniscono le funzionalità dell&#8217;application server. Ad esempio le specifiche Jakarta EE per lo sviluppo di applicazioni</p></li><li><p>Implementano una Interfaccia (<code>org.jboss.as.controller.Extension</code>) per poter essere integrati con l&#8217;application server</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;extensions&gt;

        &lt;extension module="org.jboss.as.clustering.infinispan"/&gt;
        &lt;extension module="org.jboss.as.connector"/&gt;
        &lt;extension module="org.jboss.as.deployment-scanner"/&gt;
        &lt;extension module="org.jboss.as.ee"/&gt;
        &lt;extension module="org.jboss.as.ejb3"/&gt;

&lt;/extensions&gt;</code></pre></div></div></div></section>
<section id="_path"><h2>Path</h2><div class="slide-content"><div class="ulist"><ul><li><p>Nome logico per un percorso del file system.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;path name="log.dir" path="/home/wildfly/logs" /&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Utilizzabile come riferimento in altre sezioni della configurazione (es. logs). Esempio:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;file relative-to="log.dir" path="server.log"/&gt;</code></pre></div></div></div></section>
<section id="_path_relativi"><h2>Path Relativi</h2><div class="slide-content"><div class="paragraph"><p>Un Path può anche essere relativo a una definizione di percorso esistente, come in questo caso dove si fa riferimento alla directory dati del server:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;path name="logdata.dir" path="example"
  relative-to="jboss.server.data.dir"/&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Il parametro <code>relative-to</code> si combina con il path di riferimento</p></li></ul></div></div></section>
<section id="_interfaces"><h2>Interfaces</h2><div class="slide-content"><div class="ulist"><ul><li><p>Mappano gli host/IP address dell&#8217;application server</p></li><li><p>Interfacce disponibili di default</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;interfaces&gt;
    &lt;interface name="management"&gt;
        &lt;inet-address value="${jboss.bind.address.management:127.0.0.1}"/&gt;
    &lt;/interface&gt;
    &lt;interface name="public"&gt;
        &lt;inet-address value="${jboss.bind.address:127.0.0.1}"/&gt;
    &lt;/interface&gt;
&lt;/interfaces&gt;</code></pre></div></div></div></section>
<section id="_interfaces_2"><h2>Interfaces</h2><div class="slide-content"><div class="ulist"><ul><li><p>Per essere visibile all&#8217;esterno occorre sostituire l&#8217;interfaccia di loopback</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">  &lt;interface name="public"&gt;
        &lt;inet-address value="${jboss.bind.address:192.168.10.1}"/&gt;
    &lt;/interface&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>In alternativa, fornire all&#8217;avvio la System Property:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ standalone.sh -Djboss.bind.address=192.168.10.1</code></pre></div></div></div></section>
<section id="_socket_bindings"><h2>Socket bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Contiene le porte utilizzate da WildFly</p></li><li><p>E' possibile impostare un offset per tutte le porte</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;socket-binding-group name="standard-sockets" default-interface="public"
                      port-offset="${jboss.socket.binding.port-offset:0}"&gt;
        &lt;socket-binding name="management-http"
                      interface="management" port="${jboss.management.http.port:9990}"/&gt;
        . . . .
&lt;/socket-binding-group&gt;</code></pre></div></div></div></section>
<section id="_property"><h2>Property</h2><div class="slide-content"><div class="ulist"><ul><li><p>Imposta Java System Property all&#8217;avvio di WildFly</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;system-properties&gt;
        &lt;property name="myproperty" value="false"/&gt;
&lt;/system-properties&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Equivalente a:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ ./standalone.sh -Dmyproperty=value</code></pre></div></div></div></section>
<section id="_profili_del_server"><h2>Profili del server</h2><div class="slide-content"><div class="ulist"><ul><li><p>Contiene un elenco di subsystem</p></li><li><p>Ogni subsystem corrisponde ad una <code>extension</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;profile&gt;

        &lt;subsystem
xmlns="urn:jboss:domain:logging:6.0"&gt;

        . . . ..

&lt;/profile&gt;</code></pre></div></div></div></section>
<section id="_files_di_configurazioni_in_modalità_standalone"><h2>Files di configurazioni in modalità Standalone</h2><div class="slide-content"><div class="ulist small"><ul><li><p>standalone.xml : Default. Non include messaging o clustering</p></li><li><p>standalone-full.xml : Aggiunge al default il server ActiveMQ e lo stack iiop-openjdk.</p></li><li><p>standalone-ha.xml : Aggiunge al default il supporto per HA.</p></li><li><p>standalone-full-ha.xml : Aggiunge al profilo ha il server ActiveMQ</p></li><li><p>standalone-microprofile.xml : Fornisce la API Eclipse MicroProfile</p></li><li><p>standalone-microprofile-ha.xml : Fornisce le API Eclipse MicroProfile e HA</p></li><li><p>standalone-load-balancer.xml : Fornisce il Server Undertow come Load Balancer</p></li></ul></div></div></section>
<section id="_configurare_le_impostazioni_jvm_in_modalità_standalone"><h2>Configurare le impostazioni JVM in modalità standalone</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consigliato impostare in <code>standalone.conf</code> (Linux) o <code>standalone.conf.bat</code> (Windows)</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">JAVA_OPTS="-Xms64m -Xmx1024m -XX:MaxMetaspaceSize=256M"</code></pre></div></div></div></section>
<section id="_configurare_network_interfaces_in_standalone_mode_da_cli"><h2>Configurare network interfaces in standalone mode da CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>Collegarsi alla Command Line Interface:</p></li><li><p>Settare l&#8217;attributo del Model. Esempio:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/interface=management/:write-attribute(name=inet-address,value=${jboss.bind.address.management:192.168.10.1})</code></pre></div></div></div></section>
<section id="_configurare_i_socket_bindings"><h2>Configurare i Socket Bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Due tipologie di Socket Bindings: Inbound and Outbound.</p></li><li><p><strong>Inbound socket bindings</strong> controllano i Socket in ingresso</p></li><li><p><strong>Outbound sockets</strong> controllano i Socket in uscita</p></li></ul></div></div></section>
<section id="_esempio_settaggio_socket_bindings"><h2>Esempio Settaggio Socket Bindings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Settaggio di un InBound Socket binding (Servizio HTTP):</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/socket-binding-group=standard-sockets/socket-binding=http/
:write-attribute(name=port,value=${jboss.http.port:8180})</code></pre></div></div>
<div class="ulist"><ul><li><p>Settaggio di Socket OutBound (Servizio mail)</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/socket-binding-group=standard-sockets/
remote-destination-outbound-socket-binding=mail-smtp/
:write-attribute(name=host,value=localhost)</code></pre></div></div></div></section>
<section id="_wildfly_domain_mode_scopo"><h2>WildFly Domain mode: scopo</h2><div class="slide-content"><div class="ulist"><ul><li><p>Gestione centralizzata di più istanze del server.</p></li><li><p>Divisione logica di cluster di servers</p></li><li><p>Condivisione delle risorse e delle configurazioni tra le istanze.</p></li><li><p>Miglior controllo nella amministrazione e gestione di più unità di servers</p></li></ul></div></div></section>
<section id="_componenti_di_un_dominio_di_servers"><h2>Componenti di un Dominio di Servers</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Domain Controller</strong>: Il punto di controllo di gestione del tuo dominio. Detiene una configurazione centralizzata condiviso dalle istanze dei servers di dominio.</p></li><li><p><strong>Host Controller</strong>: Il processo responsabile della coordinazione dei nodi del server con il Domain Controller. Ogni Host Controller ha il proprio file di configurazione host.xml.</p></li><li><p><strong>Server</strong>: Processi Java che corrispondono alle istanze di WildFly. Ogni nodo fa parte di un Server Group.</p></li></ul></div></div></section>
<section id="_architettura_dominio"><h2>Architettura Dominio</h2><div class="slide-content"><div class="ulist"><ul><li><p>Esempio Dominio:</p></li></ul></div>
<div class="imageblock"><img src="images/domain-view.png" alt="domain view"></div></div></section>
<section id="_configurazione_domain_controller_1"><h2>Configurazione Domain Controller (1)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Definizione del Domain Controller</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;domain-controller&gt;

        &lt;local/&gt;

&lt;/domain-controller&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Aggiunta di un utente di Management:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">./add-user.sh -ds -m -u wildflyadmin -p password1!</code></pre></div></div></div></section>
<section id="_configurazione_domain_controller_2"><h2>Configurazione Domain Controller (2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Utilizzo di una interfaccia di Management</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;management-interfaces&gt;

                &lt;native-interface sasl-authentication-factory="management-sasl-authentication"&gt;
                                &lt;socket interface="management" port="9999"/&gt;
                &lt;/native-interface&gt;

&lt;/management-interfaces&gt;</code></pre></div></div></div></section>
<section id="_configurazione_host_controller_1"><h2>Configurazione Host Controller (1)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Definizione nome Host</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;host xmlns="urn:jboss:domain:20.0" name="host1"&gt;</code></pre></div></div></div></section>
<section id="_configurazione_host_controller_2"><h2>Configurazione Host Controller (2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Definizione di una Management Interface</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;management-interfaces&gt;
    &lt;http-interface http-authentication-factory="management-http-authentication"&gt;
        &lt;http-upgrade enabled="true" sasl-authentication-factory="management-sasl-authentication"/&gt;
        &lt;socket interface="management" port="${jboss.management.http.port:19990}"/&gt;
    &lt;/http-interface&gt;
&lt;/management-interfaces&gt;</code></pre></div></div></div></section>
<section id="_configurazione_host_controller_3"><h2>Configurazione Host Controller (3)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Definizione dei Servers</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">  &lt;servers&gt;
        &lt;server name="server-prod-one" group="main-server-group"&gt;
            &lt;socket-bindings port-offset="100"/&gt;
        &lt;/server&gt;
        &lt;server name="server-dev-one" group="other-server-group"&gt;
            &lt;socket-bindings port-offset="200"/&gt;
        &lt;/server&gt;
    &lt;/servers&gt;</code></pre></div></div></div></section>
<section id="_configurazione_host_controller_4"><h2>Configurazione Host Controller (4)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Configura autenticazione verso il Domain Controller</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml"> &lt;authentication-client&gt;
        &lt;authentication-configuration name="hostAuthConfig" authentication-name="wildflyadmin" realm="ManagementRealm" sasl-mechanism-selector="DIGEST-MD5"&gt;
            &lt;credential-reference clear-text="password1!"/&gt;
        &lt;/authentication-configuration&gt;
        &lt;authentication-context name="hcAuthContext"&gt;
            &lt;match-rule authentication-configuration="hostAuthConfig"/&gt;
        &lt;/authentication-context&gt;
 &lt;/authentication-client&gt;</code></pre></div></div></div></section>
<section id="_configurazione_host_controller_5"><h2>Configurazione Host Controller (5)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Configura puntamento verso il Domain Controller</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">    &lt;domain-controller&gt;
        &lt;remote protocol="remote" host="${jboss.domain.master.address:localhost}" port="9999" authentication-context="hcAuthContext"&gt;
            &lt;discovery-options&gt;
                &lt;static-discovery name="discovery-one" protocol="${jboss.domain.master.protocol:remote}" host="${jboss.domain.master.address:localhost}" port="${jboss.domain.master.port:19999}"/&gt;
            &lt;/discovery-options&gt;
        &lt;/remote&gt;
    &lt;/domain-controller&gt;</code></pre></div></div></div></section>
<section id="_avvio_dominio"><h2>Avvio Dominio</h2><div class="slide-content"><div class="ulist"><ul><li><p>In presenza di default values per Domain Controller e Host Controller:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ ./domain.sh</code></pre></div></div>
<div class="ulist"><ul><li><p>Parametri utili per configurazioni custom</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ domain.sh --host-config=host-slave.xml \
   -Djboss.domain.base.dir=/path/domain</code></pre></div></div></div></section>
<section id="_set_up_domain"><h2>Set Up Domain</h2><div class="slide-content"><div class="ulist"><ul><li><p>Lab</p></li></ul></div></div></section>
<section id="_practice_domain_management"><h2>Practice Domain Management</h2><div class="slide-content"><div class="ulist"><ul><li><p>Lab</p></li></ul></div></div></section>
<section id="_capitolo_3_gestione_del_server_con_la_console_web"><h2>Capitolo 3: Gestione del server con la console Web</h2><div class="slide-content"><div class="ulist"><ul><li><p>La console Web consente di amministrare WildFly da browser</p></li><li><p>Semplifica l&#8217;accesso alle risorse del Server</p></li><li><p>Risorsa utile per raggiungere servers remoti senza JBoss Client libs</p></li><li><p>Richiede sempre un&#8217;utenza di Management</p></li></ul></div></div></section>
<section id="_connessione_alla_console_hal"><h2>Connessione alla console HAL</h2><div class="slide-content"><div class="paragraph"><p>Indirizzo di default:</p></div>
<div class="ulist"><ul><li><p><a href="http://localhost:9990" class="bare">http://localhost:9990</a></p></li></ul></div></div></section>
<section id="_tour_della_console_web"><h2>Tour della Console Web</h2><div class="slide-content"><div class="paragraph"><p>Lab</p></div></div></section>
<section id="_capitolo_4_gestione_del_server_con_la_cli"><h2>Capitolo 4: Gestione del server con la CLI</h2><div class="slide-content"><div class="paragraph"><p>Vantaggi Command Line Interface</p></div>
<div class="ulist"><ul><li><p>Consente scripting comandi</p></li><li><p>Può funzionare in modalità embedded</p></li><li><p>Può eseguire gli script in batch</p></li><li><p>Interfaccia poliglotta</p></li><li><p>Consente espansione dei comandi</p></li></ul></div></div></section>
<section id="_avviare_la_riga_di_comando"><h2>Avviare la riga di comando</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ ./jboss-cli.sh</code></pre></div></div>
<div class="paragraph"><p>Oppure:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> ./jboss-cli.sh --connect 192.168.10.1 --user=admin1234 --password=password1234!</code></pre></div></div>
<div class="paragraph"><p>Esecuzione script CLI:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ ./jboss-cli.sh --file=myscript.cli</code></pre></div></div></div></section>
<section id="_recupero_della_configurazione_del_server_utilizzando_la_cli"><h2>Recupero della configurazione del server utilizzando la CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>La configurazione del Server è composta da un insieme di risorse</p></li><li><p>Le risorse sono organizzate in gerarchie</p></li><li><p>Esempio:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/server=default-server/http-listener=default</code></pre></div></div></div></section>
<section id="_esecuzione_dei_comandi_con_la_cli"><h2>Esecuzione dei comandi con la CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>Una volta raggiunta una risorsa è possibile espandare le operazioni disponibili con <code>:</code></p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/server=default-server/http-listener=default:
add                         query                       read-resource
list-add                    read-attribute              read-resource-description
list-clear                  read-attribute-group        remove</code></pre></div></div></div></section>
<section id="_lettura_degli_attributi_delle_risorse"><h2>Lettura degli attributi delle risorse</h2><div class="slide-content"><div class="ulist"><ul><li><p>Per leggere gli attributi di una risorsa si utilizza l&#8217;operation <code>read-resource</code>:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/server=default-server/http-listener=default:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "buffer-pool" =&gt; "default",
        "enabled" =&gt; true,
        "max-post-size" =&gt; 10485760L,
        "socket-binding" =&gt; "http",
        "worker" =&gt; "default"
    }
}</code></pre></div></div></div></section>
<section id="_scrittura_degli_attributi_delle_risorse"><h2>Scrittura degli attributi delle risorse</h2><div class="slide-content"><div class="ulist"><ul><li><p>Per modificare gli attributi di una risorsa si utilizza l&#8217;operation <code>write-attribute</code>:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/socket-binding-group=standard-sockets/socket-binding=http:write-attribute(name=port,value=8280)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}</code></pre></div></div></div></section>
<section id="_aggiunta_di_nuove_risorse"><h2>Aggiunta di nuove risorse</h2><div class="slide-content"><div class="ulist"><ul><li><p>Per aggiungere una risorsa si utilizza l&#8217;operation <code>add</code>:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=naming/binding=java\:global\/myname:add(binding-type=simple, type=int, value=100)</code></pre></div></div></div></section>
<section id="_navigazione_nella_cronologia_dei_comandi_cli"><h2>Navigazione nella cronologia dei comandi CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>I comandi della CLI sono memorizzati nella history nel file <code>$HOME/.jboss-cli-history</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">history</code></pre></div></div>
<div class="ulist"><ul><li><p>E' combinabile con il comando <code>grep</code> come il comando equivalente dell&#8217;OS:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">history | grep 9999</code></pre></div></div></div></section>
<section id="_abilitare_la_risoluzione_delle_proprietà_nella_cli"><h2>Abilitare la risoluzione delle proprietà nella CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>E' possibile passare System Properties alla CLI:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">./jboss-cli.sh  -c -Dmyval=foo --resolve-parameter-values</code></pre></div></div>
<div class="ulist"><ul><li><p>Le System Properties saranno utilizzabile nei comandi CLI:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/system-property=foo:add(value=${myval})</code></pre></div></div></div></section>
<section id="_rilevamento_delle_operazioni_attive"><h2>Rilevamento delle operazioni attive</h2><div class="slide-content"><div class="ulist"><ul><li><p>E' possibile eseguire Auditing sui comandi CLI in esecuzione</p></li><li><p>Utili per sicurezza e per tracciare eventuali comandi in stallo:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/core-service=management/service=management-operations:read-children-resources(child-type=active-operation)</code></pre></div></div>
<div class="ulist"><ul><li><p>E' possibile cancellare le operazioni bloccate:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/core-service=management/service=management-operations:cancel-non-progressing-operation</code></pre></div></div></div></section>
<section id="_audit_dei_comandi_cli"><h2>Audit dei comandi CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consente di tenere un log delle operazioni inviate alla CLI. Di default non è abilitato</p></li><li><p>Per abilitare l&#8217;auditing delle operazioni che modificano la configurazione:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/core-service=management/access=audit/logger=audit-log:write-attribute(name=enabled,value=true)</code></pre></div></div>
<div class="ulist"><ul><li><p>Per abilitare l&#8217;auditing anche delle operazioni read-only:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> /core-service=management/access=audit/logger=audit-log:write-attribute(name=log-read-only,value=true)</code></pre></div></div></div></section>
<section id="_esecuzione_della_cli_in_modalità_grafica"><h2>Esecuzione della CLI in modalità grafica</h2><div class="slide-content"><div class="ulist"><ul><li><p>E' possibile eseguire la CLI in una applicazione Java Client:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> $ ./jboss-cli.sh --gui</code></pre></div></div>
<div class="ulist"><ul><li><p>Vantaggio: può semplificare la visione della gerarchia delle risorse e l&#8217;inserimento di nuove risorse</p></li></ul></div></div></section>
<section id="_capitolo_5_funzionalità_avanzate_della_cli"><h2>Capitolo 5: Funzionalità avanzate della CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>CLI Batch mode: Esegui una serie di comandi o annulla l&#8217;esecuzione</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[standalone@localhost:9990/] batch

[standalone@localhost:9990/#] deploy MyApplication.jar

[standalone@localhost:9990/#] /system-property=myprop:add(value=myvalue)

[standalone@localhost:9990/#] run-batch</code></pre></div></div></div></section>
<section id="_cli_batch_hack"><h2>CLI Batch Hack</h2><div class="slide-content"><div class="ulist"><ul><li><p>Come eseguire dei comandi batch contenuti in un file CLI:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[standalone@localhost:9990/] run-batch --file=myscript.cli --verbose</code></pre></div></div></div></section>
<section id="_creazione_di_snapshot_della_configurazione"><h2>Creazione di snapshot della configurazione</h2><div class="slide-content"><div class="ulist"><ul><li><p>Il comando <code>take-snapshot</code> consente di creare una copia della configurazione</p></li><li><p>Il file XML salvato contiene il Timestamp dell&#8217;operazione</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">:take-snapshot</code></pre></div></div></div></section>
<section id="_default_snapshots"><h2>Default snapshots</h2><div class="slide-content"><div class="paragraph"><p>La configurazione contiene di default una serie di Snapshot della configurazione nella cartella <code>standalone_xml_history</code></p></div>
<div class="ulist"><ul><li><p><strong>standalone.initial.xml</strong>: Configurazione originale di WildFly.</p></li><li><p><strong>standalone.boot.xml</strong>: Snapshot della configurazione presa all&#8217;avvio'</p></li><li><p><strong>standalone.last.xml</strong>: Snapshot dell&#8217;ultima configurazione valida</p></li></ul></div></div></section>
<section id="_esecuzione_della_cli_in_modalità_embedded"><h2>Esecuzione della CLI in modalità embedded</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consente di modificare la configurazione senza che sia attivo WildFly</p></li><li><p>Utile per modifiche "a freddo" della configurazione senza editare i files XML</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[disconnected /] embed-server --std-out=echo</code></pre></div></div></div></section>
<section id="_uscire_dalla_modalità_embedded"><h2>Uscire dalla modalità embedded</h2><div class="slide-content"><div class="ulist"><ul><li><p>Dopo aver eseguito le modifiche alla configurazione si termina la sessione embedded con:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[standalone@embedded /] stop-embedded-server</code></pre></div></div></div></section>
<section id="_esecuzione_della_modalità_batch_integrata_in_modalità_domain"><h2>Esecuzione della modalità batch integrata in modalità domain</h2><div class="slide-content"><div class="ulist"><ul><li><p>Esistono comandi equivalenti in modalità dominio:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">embed-host-controller --std-out=echo --domain-config=domain.xml --host-config=host.xml</code></pre></div></div>
<div class="ulist"><ul><li><p>Per uscire dalla modalità embedded:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">stop-embedded-host-controller</code></pre></div></div></div></section>
<section id="_sospendere_e_riprendere_il_server"><h2>Sospendere e riprendere il server</h2><div class="slide-content"><div class="ulist"><ul><li><p>E' possibile sospendere WildFly in modo da terminare le richieste in coda:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> :suspend</code></pre></div></div>
<div class="ulist"><ul><li><p>Sulla Console:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">10:54:43,595 INFO  [org.jboss.as.server] (management-handler-thread - 1) WFLYSRV0236: Suspending server with no timeout.
10:54:43,604 INFO  [org.jboss.as.ejb3] (management-handler-thread - 1) WFLYEJB0493: EJB subsystem suspension complete</code></pre></div></div>
<div class="ulist"><ul><li><p>Sospensione con timeout:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">:suspend(timeout=30)</code></pre></div></div></div></section>
<section id="_operazioni_consentite_dopo_la_sospensioe"><h2>Operazioni consentite dopo la sospensioe</h2><div class="slide-content"><div class="paragraph"><p>E' possibile sospendere WildFly in modo da terminare le richieste in coda:</p></div>
<div class="ulist"><ul><li><p>Deploy/undeploy applicazioni</p></li><li><p>Modifiche alla configurazione</p></li></ul></div></div></section>
<section id="_termine_della_sospensione"><h2>Termine della sospensione</h2><div class="slide-content"><div class="paragraph"><p>Per terminare la sospensione del server:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">:resume</code></pre></div></div></div></section>
<section id="_esecuzione_condizionale_con_la_cli"><h2>Esecuzione condizionale con la CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>La CLI supporta l&#8217;esecuzione condizionali di comandi</p></li><li><p>Utile per verificare la presenza di risorse prima di eseguire comandi.</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">if (outcome != success) of /deployment=myproject.war:read-resource
     deploy myproject.war
end-if</code></pre></div></div></div></section>
<section id="_capitolo_6_deploy_applicazioni"><h2>Capitolo 6: Deploy applicazioni</h2><div class="slide-content"><div class="paragraph"><p>Una applicazione può essere resa disponibile in diversi modi:</p></div>
<div class="ulist"><ul><li><p>File system copy (standalone mode only)</p></li><li><p>Mediante Management interfaces (Admin Console or CLI)</p></li><li><p>Tools (f.e. Maven WildFly plugin)</p></li></ul></div></div></section>
<section id="_deploy_applicazioni_su_file_system"><h2>Deploy applicazioni su File System</h2><div class="slide-content"><div class="paragraph"><p>Nella modalità standalone, è possibile installare le applicazioni nella cartella <code>deployments</code> del Server</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cp example.war /opt/wildfly-27.0.0.Final/standalone/deployments</code></pre></div></div>
<div class="paragraph"><p>Di default il deploy avviene in automatico per gli archivi compressi (war/jar/ear/sar)</p></div></div></section>
<section id="_deploy_applicazioni_esplose"><h2>Deploy applicazioni esplose</h2><div class="slide-content"><div class="ulist"><ul><li><p>Di default non avviene in automatico</p></li><li><p>Va aggiunto un marker file con suffisso <code>.dodeploy</code></p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ cp -r Example.ear $JBOSS_HOME/standalone/deployments

$ touch $JBOSS_HOME/standalone/deployments/Example.ear.dodeploy</code></pre></div></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Per renderlo automatico:

/subsystem=deployment-scanner/scanner=default:write-attribute(name=auto-deploy-exploded,value=true)</code></pre></div></div></div></section>
<section id="_configurazione_del_deployment_scanner"><h2>Configurazione del Deployment Scanner</h2><div class="slide-content"><div class="paragraph"><p>Vediamo nel dettaglio le proprietà del Deployment Scanner:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=deployment-scanner/scanner=default:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "auto-deploy-exploded" =&gt; false,
        "auto-deploy-xml" =&gt; true,
        "auto-deploy-zipped" =&gt; true,
        "deployment-timeout" =&gt; 600,
        "path" =&gt; "deployments",
        "relative-to" =&gt; "jboss.server.base.dir",
        "runtime-failure-causes-rollback" =&gt; expression "${jboss.deployment.scan
ner.rollback.on.failure:false}",
        "scan-enabled" =&gt; true,
        "scan-interval" =&gt; 5000
    }
}</code></pre></div></div></div></section>
<section id="_distribuzione_tramite_interfaccia_web"><h2>Distribuzione tramite interfaccia Web</h2><div class="slide-content"><div class="ulist"><ul><li><p>Seleziona il tab <strong>Deployments</strong></p></li><li><p>Aggiungi un deploy mediante il pulsante (+)</p></li><li><p>Una lista di opzioni sarà disponibile:</p></li></ul></div>
<div class="imageblock"><img src="images/deploy-webconsole.png" alt="deploy webconsole"></div></div></section>
<section id="_deploy_tramite_interfaccia_web"><h2>Deploy tramite interfaccia Web</h2><div class="slide-content"><div class="paragraph"><p>Lab</p></div></div></section>
<section id="_deploy_in_domain_mode"><h2>Deploy in Domain Mode</h2><div class="slide-content"><div class="ulist"><ul><li><p>In modalità Dominio le applicazioni vanno installate su un <strong>Server group</strong></p></li><li><p>E' possibile fare un deploy su un singolo <strong>Server group</strong> o su tutti:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Deploy su tutti i Server Groups
deploy application.war --all-server-groups

# Deploy su un singolo Server Group
deploy application.war --server-groups=main-server-group</code></pre></div></div></div></section>
<section id="_undeploy_in_domain_mode"><h2>Undeploy in Domain Mode</h2><div class="slide-content"><div class="paragraph"><p>Per la rimozione da tutti i Server groups:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">undeploy application.war --all-relevant-server-groups</code></pre></div></div>
<div class="paragraph"><p>Per la rimozione da un Server groups, se l&#8217;applicazione era disponibile solo su quel Server groups:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">undeploy application.war --server-groups=main-server-group</code></pre></div></div>
<div class="paragraph"><p>Se era distribuita su più Server groups:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">undeploy application.war --server-groups=main-server-group --keep-content</code></pre></div></div></div></section>
<section id="_deploy_in_domain_mode_tramite_web_console"><h2>Deploy in Domain Mode tramite Web Console</h2><div class="slide-content"><div class="paragraph"><p>Analogamente alla CLI, l&#8217;applicazione va distribuita su un Server Group</p></div>
<div class="imageblock"><img src="images/deploy-domain.png" alt="deploy domain"></div></div></section>
<section id="_deploy_applicazioni_utilizzando_maven_1"><h2>Deploy applicazioni utilizzando Maven (1)</h2><div class="slide-content"><div class="paragraph"><p>E' possibile eseguire il deploy applicativo inserendo questo Maven plugin nel file di progetto <code>pom.xml</code>:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;plugin&gt;
        &lt;groupId&gt;org.wildfly.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;wildfly-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;4.0.0.Final&lt;/version&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>Ref: <a href="https://docs.wildfly.org/wildfly-maven-plugin/releases/4.2/" class="bare">https://docs.wildfly.org/wildfly-maven-plugin/releases/4.2/</a></p></div></div></section>
<section id="_deploy_applicazioni_utilizzando_maven_2"><h2>Deploy applicazioni utilizzando Maven (2)</h2><div class="slide-content"><div class="paragraph"><p>Goals disponibili in questo plugin:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Deploy applicazione
mvn wildfly:deploy

# Undeploy applicazione
mvn wildfly:undeploy

# Redeploy applicazione
mvn wildfly:redeploy</code></pre></div></div></div></section>
<section id="_capitolo_7_configurazione_connessioni_al_db"><h2>Capitolo 7: Configurazione Connessioni al DB</h2><div class="slide-content"><div class="paragraph"><p>Le connessioni verso il Database sono configurate tramite il componente DataSource</p></div>
<div class="paragraph"><p>Esistono due subsystem utilizzabili:</p></div>
<div class="ulist"><ul><li><p>Datasource standard: Il datasource standard basato sullo standard JCA (Java Connector Architecture)</p></li><li><p>Datasource Agroal: Versione "slim" del datasource. Non disponibile di default</p></li></ul></div></div></section>
<section id="_creazione_di_un_datasource_utilizzando_la_cli"><h2>Creazione di un datasource utilizzando la CLI</h2><div class="slide-content"><div class="paragraph"><p>E' possibile aggiungere un Datasource in diversi modi:</p></div>
<div class="ulist"><ul><li><p>Installando il modulo nell&#8217;application server e configurando le risorse Datasource/JDBC Driver</p></li><li><p>Facendo il deploy del driver JDBC e configurando le risorsa Datasource</p></li><li><p>Configurato per via applicativa</p></li></ul></div></div></section>
<section id="_esempio_di_creazione_di_datasource_come_modulo"><h2>Esempio di creazione di Datasource come modulo</h2><div class="slide-content"><div class="paragraph"><p>Da Command Line:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">module add --name=org.postgres --resources=postgresql-42.2.8.jar --dependencies=javax.api,javax.transaction.api

/subsystem=datasources/jdbc-driver=postgres:add(driver-name="postgres",driver-module-name="org.postgres",driver-class-name=org.postgresql.Driver)

data-source add --jndi-name=java:/PostGreDS --name=PostgrePool --connection-url=jdbc:postgresql://localhost:5432/postgres --driver-name=postgres --user-name=postgres --password=postgres</code></pre></div></div></div></section>
<section id="_inside_datasource_module"><h2>Inside Datasource module</h2><div class="slide-content"><div class="paragraph"><p>Ogni Datasource deve estendere <code>javax.api</code> e <code>javax.transaction.api</code> . Il modulo deve includere il JDBC Driver:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="org.postgres"&gt;
  &lt;resources&gt;
    &lt;resource-root path="postgresql-42.2.8.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javax.api"/&gt;
    &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;</code></pre></div></div></div></section>
<section id="_creazione_di_un_datasource_in_modalità_domain"><h2>Creazione di un datasource in modalità domain</h2><div class="slide-content"><div class="paragraph"><p>In modalità Dominio i comandi sono simili ma va aggiunto il riferimento al <code>profile</code> :</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[disconnected /] module add --name=org.postgres --resources=postgresql-42.2.8.jar --dependencies=javax.api,javax.transaction.api

[domain@192.168.0.1:9990 /] /profile=full-ha/subsystem=datasources/jdbc-driver=postgres:add(driver-name="postgres",driver-module-name="org.postgres",driver-class-name=org.postgresql.Driver)

[domain@192.168.0.1:9990 /] data-source add --jndi-name=java:/PostGreDS --name=PostgrePool --connection-url=jdbc:postgresql://localhost:5432/postgres --driver-name=postgres --user-name=postgres --password=postgres --profile=full-ha</code></pre></div></div></div></section>
<section id="_creazione_di_un_datasource_xa"><h2>Creazione di un datasource XA</h2><div class="slide-content"><div class="ulist"><ul><li><p>La creazione del modulo e del JDBC Driver è identica.</p></li><li><p>L&#8217;oggetto xa-data-source va configurato disaccoppiando la risorsa dalle property:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">xa-data-source add --name=PostGresXA --jndi-name=java:/PostGresXA --driver-name=postgres --xa-datasource-class=org.postgresql.xa.PGXADataSource --user-name=postgres --password=postgres --xa-datasource-properties=[{ServerName=localhost}]

/subsystem=datasources/xa-data-source=PostGresXA/xa-datasource-properties=DatabaseName:add(value="postgres")</code></pre></div></div></div></section>
<section id="_configurazione_di_un_datasource_utilizzando_la_console_web"><h2>Configurazione di un datasource utilizzando la Console Web</h2><div class="slide-content"><div class="paragraph"><p>Lab su come configurare il Datasource da Console</p></div>
<div class="imageblock"><img src="images/datasource-view.png" alt="datasource view"></div></div></section>
<section id="_distribuzione_di_un_datasource_come_risorsa"><h2>Distribuzione di un datasource come risorsa</h2><div class="slide-content"><div class="paragraph"><p>Il JDBC Driver è riconosciuto come modulo in automatico. Può essere anche configurato come segue:</p></div>
<div class="ulist"><ul><li><p>Da linea di Comando:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> cp postgresql-42.2.8.jar  /opt/wildfly-27.0.0.Final/standalone/deployments</code></pre></div></div>
<div class="ulist"><ul><li><p>Da CLI WildFly:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">data-source add --name=PostgrePoolDeploy --jndi-name=java:/PostgreDSDeploy --driver-name=postgresql-42.2.8.jar --connection-url=jdbc:postgresql://localhost/postgres --user-name=postgres --password=postgres</code></pre></div></div></div></section>
<section id="_configurazione_pool_12"><h2>Configurazione Pool (1/2)</h2><div class="slide-content"><div class="paragraph"><p>Attributi principali:</p></div>
<div class="ulist"><ul><li><p><strong>min-pool-size</strong>: Il numero minimo di connessioni nel pool (impostato di default a 0)</p></li><li><p><strong>initial-pool-size</strong>: Il numero iniziale di connessioni da acquisire dal database</p></li><li><p><strong>max-pool-size</strong>: Il numero massimo di connessioni nel pool (impostato di default a 20)</p></li><li><p><strong>pool-use-strict-min</strong>: Indica se le connessioni inattive al di sotto di min-pool-size dovrebbero essere chiuse</p></li></ul></div></div></section>
<section id="_configurazione_pool_22"><h2>Configurazione Pool (2/2)</h2><div class="slide-content"><div class="paragraph"><p>Attributi principali:</p></div>
<div class="ulist"><ul><li><p><strong>pool-prefill</strong>: Tentativi di precaricare il pool di connessioni al numero minimo di connessioni. Questo controllerà le connessioni non appena il Datasource è installato.</p></li><li><p><strong>flush-strategy</strong>: Specifica come dovrebbe essere svuotato il pool in caso di errore. L&#8217;impostazione predefinita (FailingConnectionOnly) comporta la distruzione solo delle connessioni con errori.</p></li><li><p><strong>idle-timeout-minutes</strong>: Specifica il tempo massimo, in minuti, in cui una connessione può rimanere inattiva prima di essere chiusa.</p></li><li><p><strong>track-statements</strong>: Indica se verificare la presenza di statement non chiusi quando una connessione viene restituita al pool. I valori validi sono: "false" (non tracciare gli statement), "true" (traccia gli statement e i risultati dei set e avvisa quando non vengono chiusi), "nowarn" (traccia gli statement ma non avvisa se non vengono chiusi).</p></li></ul></div></div></section>
<section id="_validazione_delle_connessioni_al_database"><h2>Validazione delle connessioni al database</h2><div class="slide-content"><div class="ulist"><ul><li><p>Essenziale per verificare se le connessioni sono ancora attive e funzionanti.</p></li><li><p>Può essere eseguita in due modi (in via esclusiva):</p><div class="ulist"><ul><li><p>Validate on Match: Validazione puntuale su ogni statement</p></li><li><p>Background Validation: Validazione eseguita con un Thread in background</p></li></ul></div></li></ul></div></div></section>
<section id="_validate_on_match"><h2>Validate on Match</h2><div class="slide-content"><div class="ulist"><ul><li><p>Esegue una validazione puntale per ogni esecuzione</p></li><li><p>E' il sistema più affidabile per una validazione delle connessioni</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=datasources/data-source=PostgrePool:write-attribute(name=validate-on-match,value=true)</code></pre></div></div></div></section>
<section id="_background_validation"><h2>Background Validation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Esegue una validazione in un Thread esterno</p></li><li><p>E' configurabile la frequenza della validazione</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=datasources/data-source=PostgrePool:write-attribute(name=background-validation, value=true)

/subsystem=datasources/data-source=PostgrePool:write-attribute(name=background-validation-millis, value=10000)</code></pre></div></div></div></section>
<section id="_statistiche_datasource"><h2>Statistiche Datasource</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le statistiche del Pool di connessione sono disponibili coma attributo Runtime del Datasource</p></li><li><p>Come per altri subsystem, vanno abilitate</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=datasources/data-source=PostgrePool/statistics=pool:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "ActiveCount" =&gt; 1,
        "AvailableCount" =&gt; 19,
        "AverageBlockingTime" =&gt; 0L,
        "AverageCreationTime" =&gt; 331L,
        "AverageGetTime" =&gt; 166L,
        "AveragePoolTime" =&gt; 175000L,
        "AverageUsageTime" =&gt; 18L,
         . . . . .</code></pre></div></div></div></section>
<section id="_configurazione_del_datasource_agroal"><h2>Configurazione del datasource Agroal</h2><div class="slide-content"><div class="ulist"><ul><li><p>Può offrire prestazioni / memory footprint migliori</p></li><li><p>Non disponibile di default, va attivato:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/extension=org.wildfly.extension.datasources-agroal:add

/subsystem=datasources-agroal:add</code></pre></div></div></div></section>
<section id="_utilizzo_del_datasource_agroal"><h2>Utilizzo del Datasource Agroal</h2><div class="slide-content"><div class="ulist"><ul><li><p>Comandi identici al datasource standard</p></li><li><p>La differenza è che si fa riferimento al <code>datasources-agroal</code> subsystem</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=datasources-agroal/driver=agroal_driver:add(class=org.postgresql.Driver,module=org.postgres)</code></pre></div></div></div></section>
<section id="_capitolo_8_configurazione_del_server_web_undertow"><h2>Capitolo 8: Configurazione del server Web Undertow</h2><div class="slide-content"><div class="ulist"><ul><li><p>Il Web Server Undertow fornisce supporto per applicazioni Web</p></li><li><p>Utilizza il subsystem <code>io</code> per gestire le connessioni in ingresso</p></li><li><p>Architettura estendibile con Handlers e Filters</p></li></ul></div></div></section>
<section id="_configurazione_dei_filtri"><h2>Configurazione dei filtri</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un filtro consente di modificare una richiesta HTTP</p></li><li><p>Può utilizzare i predicati per controllare quando un filtro viene eseguito.</p></li></ul></div>
<div class="paragraph"><p>Esempi:</p></div>
<div class="ulist"><ul><li><p>Response Header Filter</p></li><li><p>Connection Limit Filter</p></li><li><p>Response Compression Filter</p></li><li><p>Error Filter</p></li></ul></div></div></section>
<section id="_response_header_filter"><h2>Response Header Filter</h2><div class="slide-content"><div class="paragraph"><p>Filter che aggiunge un Response Header "WildFly-Dev":</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/configuration=filter/response-header=server-header:add(header-name=my-response-header, header-value="WildFly-Dev")

/subsystem=undertow/server=default-server/host=default-host/filter-ref=server-header/:add()</code></pre></div></div>
<div class="imageblock"><img src="images/response_filter.png" alt="response filter"></div></div></section>
<section id="_connection_limit_filter"><h2>Connection Limit Filter</h2><div class="slide-content"><div class="paragraph"><p>E' possibile utilizzare un Filter per aggiungere dei limiti alle connessioni di Undertow. Esempio:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/configuration=filter/connection-limit=mylimit/:add(max-concurrent-requests=25,queue-size=100)

/subsystem=undertow/server=default-server/host=default-host/filter-ref=mylimit/:add()</code></pre></div></div></div></section>
<section id="_gzip_filter"><h2>Gzip Filter</h2><div class="slide-content"><div class="paragraph"><p>Mediante un <strong>gzip</strong> filter è possibile comprimere la Response. Esempio:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/configuration=filter/gzip=zipfilter/:add()

/subsystem=undertow/server=default-server/host=default-host/filter-ref=zipfilter/:add()</code></pre></div></div></div></section>
<section id="_error_filter"><h2>Error Filter</h2><div class="slide-content"><div class="paragraph"><p>In alternativa a definire pagine di errore nel file <code>web.xml</code> è possibile impostare un Filter per un codice di errore HTTP:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">batch

/subsystem=undertow/server=default-server/host=default-host/filter-ref=404-handler:add(predicate=true)

/subsystem=undertow/configuration=filter/error-page=404-handler/:add(code=404,path=/var/docs/www/error.html)

run-batch</code></pre></div></div></div></section>
<section id="_custom_filter"><h2>Custom Filter</h2><div class="slide-content"><div class="paragraph"><p>E' possibile definire un Filtro Custom implementando <code>io.undertow.server.HttpHandler</code> :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public interface HttpHandler {

    void handleRequest(HttpServerExchange exchange) throws Exception;

}</code></pre></div></div>
<div class="paragraph"><p>Il modulo con il Filtro va installato su Wildfly con:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/configuration=filter/custom-filter=custom-filter/:add(class-name=io.undertow.server.handlers.HttpTraceHandler,module=io.undertow.core)</code></pre></div></div></div></section>
<section id="_configurazione_handlers_undertow"><h2>Configurazione Handlers Undertow</h2><div class="slide-content"><div class="ulist"><ul><li><p>Gli Undertow Handlers sono classi Java che implementano <code>io.undertow.server.HttpHandler</code></p></li><li><p>Gestiscono la Request e selezionano il prossimo Handler</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class ExampleHandler implements HttpHandler {

    @Override
    public void handleRequest(final HttpServerExchange exchange) throws Exception {
       // implementation
    }
}</code></pre></div></div></div></section>
<section id="_esempio_reverse_proxy_handler_1"><h2>Esempio: Reverse Proxy Handler 1</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un Reverse Proxy può essere utilizzato per fare da proxy per le richieste da un Host A verso un Host B</p></li><li><p>Esempio: Come indirizzare le richieste da <code>localhost:8080/in</code> &#8658; <code>localhost:8180/out</code></p></li></ul></div>
<div class="imageblock"><img src="images/reverse-proxy-handler.png" alt="reverse proxy handler"></div></div></section>
<section id="_esempio_reverse_proxy_handler_2"><h2>Esempio: Reverse Proxy Handler 2</h2><div class="slide-content"><div class="paragraph"><p>Implementazione pratica:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">batch

/subsystem=undertow/configuration=handler/reverse-proxy=myproxy:add()

/subsystem=undertow/configuration=handler/reverse-proxy=myproxy/host=localhost:add(instance-id="myRoute",outbound-socket-binding="http-remote",path="/out",scheme="http")

/subsystem=undertow/server=default-server/host=default-host/location="/in":add(handler="myproxy")

/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=http-remote/:add(host=localhost,port=8180)

run-batch</code></pre></div></div></div></section>
<section id="_configurazione_undertow_listeners"><h2>Configurazione Undertow Listeners</h2><div class="slide-content"><div class="ulist"><ul><li><p>I listeners sono i punti di ingresso ad un Server Undertow</p></li><li><p>Ogni listener è collegato ad un <code>socket-binding</code>:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">&lt;http-listener name="default" socket-binding="http" redirect-socket="https" enable-http2="true"/&gt;
&lt;https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/&gt;</code></pre></div></div></div></section>
<section id="_configurazione_del_numero_massimo_di_connessioni_per_i_listener_undertow"><h2>Configurazione del numero massimo di connessioni per i listener Undertow</h2><div class="slide-content"><div class="paragraph"><p>Numero massimo di connessioni contemporanee per un Listener:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;http-listener name="default" max-connections="300"
    socket-binding="http" redirect-socket="https" enable-http2="true"/&gt;</code></pre></div></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/server=default-server/http-listener=default:write-attribute(name=max-connections,value=300)</code></pre></div></div></div></section>
<section id="_connection_pool_undertow"><h2>Connection Pool Undertow</h2><div class="slide-content"><div class="paragraph"><p>Undertow utilizza un Pool di XNIO Workers:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=io/worker=default:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "io-threads" <b>(1)</b>
        "stack-size" <b>(2)</b>
        "task-core-threads" <b>(3)</b>
        "task-max-threads" =&gt; <b>(4)</b>
        }
    }
}</code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Threads I/O Condivisi tra Connessioni (non-blocking)</p></li><li><p>Web Server Thread Stack Size</p></li><li><p>Numero iniziale di Core Workers (blocking)</p></li><li><p>Numero max di Core Workers (blocking)</p></li></ol></div></div></section>
<section id="_custom_worker"><h2>Custom Worker</h2><div class="slide-content"><div class="paragraph"><p>Esempio: Custom worker <strong>largerworker</strong> con <code>io-threads</code> a 10 e <code>task-max-threads</code> a 100:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=io/worker=largeworker/:add(io-threads=10,stack-size=0,task-keepalive=60,task-max-threads=100)

batch
/subsystem=undertow/server=default-server/http-listener=default/:write-attribute(name=worker,value=largeworker)
# Needed for remoting
/subsystem=remoting:write-attribute(name=worker,value=largeworker)
run-batch</code></pre></div></div></div></section>
<section id="_buffer_pool_configuration"><h2>Buffer Pool Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un Buffer è un&#8217;area di memoria temporanea utilizzata per memorizzare dati prima di essere lavorata.</p></li><li><p>Come configurare ed applicare un Buffer Pool:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/byte-buffer-pool=mybuffer/:add(buffer-size=32000,leak-detection-percent=0,max-pool-size=20,thread-local-cache-size=12)

/subsystem=undertow/server=default-server/http-listener=default:write-attribute(name=buffer-pool,value=mybuffer)</code></pre></div></div></div></section>
<section id="_configurazione_degli_host_virtuali_in_undertow"><h2>Configurazione degli host virtuali in Undertow</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un Virtual Host consente di ospitare più domini in un singolo Server</p></li><li><p>Richiede tre passagi:</p><div class="ulist"><ul><li><p>Configurazione a livello OS</p></li><li><p>Configurazione a livello Undertow</p></li><li><p>Configurazione applicativa (optional)</p></li></ul></div></li></ul></div></div></section>
<section id="_virtual_host_configuration_1"><h2>Virtual Host Configuration 1</h2><div class="slide-content"><div class="ulist"><ul><li><p>Mappa sul tuo OS i domini aggiuntivi</p></li><li><p>Esempio:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">127.0.0.1 my-wildfly</code></pre></div></div></div></section>
<section id="_virtual_host_configuration_2"><h2>Virtual Host Configuration 2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Configurazione a livello Undertow</p></li><li><p>Esempio:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">batch
/subsystem=undertow/server=default-server/host=myvirtualhost:add(alias=["my-wildfly"])
/subsystem=undertow/server=default-server/host=myvirtualhost/setting=access-log:add(prefix="myvirtualhost")
/subsystem=undertow/server=default-server/host=myvirtualhost:write-attribute(name=default-web-module,value=welcome.war)
run-batch</code></pre></div></div></div></section>
<section id="_virtual_host_configuration_3"><h2>Virtual Host Configuration 3</h2><div class="slide-content"><div class="ulist"><ul><li><p>Opzionale</p></li><li><p>Come fare il deploy applicativo su un Virtual Host:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;jboss-web&gt;
     &lt;context-root&gt;/test&lt;/context-root&gt;
     &lt;virtual-host&gt;myvirtualhost&lt;/virtual-host&gt;
&lt;/jboss-web&gt;</code></pre></div></div></div></section>
<section id="_configurazione_access_logs"><h2>Configurazione Access Logs</h2><div class="slide-content"><div class="paragraph"><p>Gli Access Logs tracciano tutte le richieste in arrivo al Server Undertow. Di default sono disabilitati.</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;host name="default-host" alias="localhost"&gt;
                    &lt;location name="/" handler="welcome-content"/&gt;
                    &lt;access-log pattern="%h %l %u %t &amp;quot;%r&amp;quot; %s %b &amp;quot;%{i,Referer}&amp;quot;
                           &amp;quot;%{i,User-Agent}&amp;quot; Cookie: &amp;quot;%{i,COOKIE}&amp;quot;
                           Set-Cookie: &amp;quot;%{o,SET-COOKIE}&amp;quot; SessionID: %S Thread: &amp;quot;%I&amp;quot; TimeTaken: %T"/&gt;
                    &lt;http-invoker security-realm="ApplicationRealm"/&gt;
 &lt;/host&gt;</code></pre></div></div>
<div class="paragraph"><p>Tracciamento tempo impiegato:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/server=default-server/http-listener=default:write-attribute(name=record-request-start-time,value=true)</code></pre></div></div></div></section>
<section id="_web_application_statistics"><h2>Web application statistics</h2><div class="slide-content"><div class="ulist"><ul><li><p>Attiva le statistiche prima:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/:write-attribute(name=statistics-enabled,value=true)</code></pre></div></div>
<div class="ulist"><ul><li><p>Per Visualizzarle, fai riferimento all&#8217;applicazione:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/deployment=web-cluster-demo.war/subsystem=undertow/:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "active-sessions" =&gt; 5,
        "context-root" =&gt; "/ demo",
        "expired-sessions" =&gt; 1,
        "max-active-sessions" =&gt; 5,
        "rejected-sessions" =&gt; 0,
        "server" =&gt; "default-server",
        "session-avg-alive-time" =&gt; 25,
        "session-max-alive-time" =&gt; 50,
        . . . .
    }</code></pre></div></div></div></section>
<section id="_http2_support"><h2>HTTP/2 Support</h2><div class="slide-content"><div class="ulist"><ul><li><p>HTTP/2 fornisce prestazioni migliori supportando multiplexing delle connessioni ed header compression.</p></li><li><p>Già disponibile nelle versioni più recenti. Verifica:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=enable-http2)
{
    "outcome" =&gt; "success",
    "result" =&gt; true
}</code></pre></div></div></div></section>
<section id="_capitolo_9_enterprise_subsystems_configuration"><h2>Capitolo 9: Enterprise subsystems configuration</h2></section>
<section id="_ejb_subsystem"><h2>EJB subsystem</h2><div class="slide-content"><div class="paragraph"><p>Il Container EJB di WildFly gestisce le diverse di tipologie di EJB con i seguenti componenti:</p></div>
<div class="ulist"><ul><li><p><strong>Stateless &amp; Message Driven Bean Pool</strong> : Pool di connessioni stateless</p></li><li><p><strong>EJB Thread Pool</strong>: Intercettano richieste dai Client EJB</p></li><li><p><strong>Stateful bean cache configuration</strong>: Cache di connessioni stateful</p></li></ul></div></div></section>
<section id="_ejb_pool_configuration"><h2>EJB Pool Configuration</h2><div class="slide-content"><div class="paragraph"><p>Il Pool di Connessioni Stateless gestisce le richieste di business ed una volta terminate ritorna nel Pool.</p></div>
<div class="imageblock"><img src="images/ejbpool.png" alt="ejbpool"></div></div></section>
<section id="_ejb_pool_size"><h2>EJB Pool size</h2><div class="slide-content"><div class="paragraph"><p>Determinata in base all&#8217;attributo <code>derive-size</code>:</p></div>
<div class="ulist"><ul><li><p><strong>from-worker-pools</strong>: calcolata in base alla dimensione del pool di workers IO</p></li><li><p><strong>from-cpu-count</strong>: calcolata in base ai processori</p></li><li><p><strong>none</strong>: calcolata in base a <code>max-pool-size</code>.</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=ejb3/strict-max-bean-instance-pool=slsb-strict-max-pool/:read-resource(recursive=false)
{
        "outcome" =&gt; "success",
        "result" =&gt; {
        "derive-size" =&gt; "from-worker-pools", <b>(1)</b>
        "max-pool-size" =&gt; 20,
        "timeout" =&gt; 5L,
        "timeout-unit" =&gt; "MINUTES"
        }
}</code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Determina come viene calcolata la dimensione del pool</p></li></ol></div></div></section>
<section id="_stateful_cache"><h2>Stateful Cache</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>simple</strong>: Impostazione di default per profili non ha. Usa in-memry storage.</p></li><li><p><strong>distribuibile</strong>: Utilizza il subsystem infinispan per memorizzare la Stateful cache</p></li></ul></div>
<div class="paragraph"><p>Settaggio:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=ejb3/:write-attribute(name=default-sfsb-cache,value=distributable)</code></pre></div></div></div></section>
<section id="_stateful_ejb_passivation"><h2>Stateful EJB Passivation</h2><div class="slide-content"><div class="paragraph"><p>Il Processo di Passivation consente di fare offloading delle Sessioni su una Cache</p></div>
<div class="paragraph"><p>Per configurare il numero massimo di Stateful EJB Attivi:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=distributable-ejb/infinispan-bean-management=default:write-attribute(name=max-active-beans,value=10000)</code></pre></div></div></div></section>
<section id="_configurazione_ejb_timeouts"><h2>Configurazione EJB Timeouts</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>StatefulTimeout</strong>: Determina la Passivazione degli EJB Stateful</p></li><li><p><strong>AccessTimeout</strong>: Timeout per richiesta EJB in coda</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Stateful timeout
/subsystem=ejb3:write-attribute(name=default-stateful-bean-session-timeout, value=10000)
# Access timeout
/subsystem=ejb3/:write-attribute(name=default-stateful-bean-access-timeout,value=5000)</code></pre></div></div></div></section>
<section id="_ejb_thread_pool"><h2>EJB Thread Pool</h2><div class="slide-content"><div class="paragraph"><p>Utilizzato dai Client Remoti che accedono agli EJB:</p></div>
<div class="imageblock"><img src="images/ejbthreadpool.png" alt="ejbthreadpool"></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=ejb3/thread-pool=default/:write-attribute(name=max-threads,value=30)</code></pre></div></div></div></section>
<section id="_ejb_timers"><h2>EJB Timers</h2><div class="slide-content"><div class="ulist"><ul><li><p>Jakarta EE supporta EJB schedulati su base temporale (EJB Timers)</p></li><li><p>Di default, la persistenza è sul file:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;timer-service thread-pool-name="default" default-data-store="default-file-store"&gt;
        &lt;data-stores&gt;
            &lt;file-data-store name="default-file-store" path="timer-service-data" relative-to="jboss.server.data.dir"/&gt;
        &lt;/data-stores&gt;
&lt;/timer-service&gt;</code></pre></div></div></div></section>
<section id="_persistenza_ejb_timers_su_db"><h2>Persistenza EJB Timers su DB</h2><div class="slide-content"><div class="ulist"><ul><li><p>La persistenza sul Database è ideale per scenari di HA</p></li><li><p>Richiede un Datasource di riferimento</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=ejb3/service=timer-service/database-data-store=clustered-store:add(datasource-jndi-name=java:/PostGreDS, database=postgresql, partition=timer)

/subsystem=ejb3/service=timer-service:write-attribute(name=default-data-store,value=clustered-store)</code></pre></div></div></div></section>
<section id="_enterprise_subsystem_ee"><h2>Enterprise subsystem ("ee")</h2><div class="slide-content"><div class="ulist"><ul><li><p>Contiene funzionalità utilizzate da applicazioni Enterprise</p><div class="ulist"><ul><li><p>XML descriptors delle applicazioni</p></li><li><p>Managed Executors</p></li><li><p>JNDI Bindings</p></li></ul></div></li></ul></div></div></section>
<section id="_xml_descriptors"><h2>XML Descriptors</h2><div class="slide-content"><div class="paragraph"><p><strong>spec-descriptor-property-replacement</strong>: Abilita la sostituzione di System Property nei descriptors XML Jakarta EE:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml"> &lt;spec-descriptor-property-replacement&gt;false&lt;/spec-descriptor-property-replacement&gt;</code></pre></div></div>
<div class="paragraph"><p><strong>jboss-descriptor-property-replacement</strong>: Abilita la sostituzione di System Property nei descriptors XML WildFly:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml"> &lt;jboss-descriptor-property-replacement&gt;false&lt;/jboss-descriptor-property-replacement&gt;</code></pre></div></div></div></section>
<section id="_managed_executors"><h2>Managed Executors</h2><div class="slide-content"><div class="ulist"><ul><li><p>Specifica Jakarta EE per utilizzare Thread Pools forniti dall&#8217;Application Server</p></li><li><p>Principali componenti:</p><div class="ulist"><ul><li><p>Managed Executor Services: Versione Jakarta EE del Java SE Executor Service</p></li><li><p>Scheduled Managed Executor Services: Versione Jakarta EE del Java SE Scheduled Executor Service</p></li></ul></div></li></ul></div></div></section>
<section id="_managed_executor_services"><h2>Managed Executor Services</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;managed-executor-services&gt;
    &lt;managed-executor-service
        name="default"
        jndi-name="java:jboss/ee/concurrency/executor/default" <b>(1)</b>
        context-service="default"
        thread-factory="default"
        hung-task-threshold="60000"
        core-threads="5"
        max-threads="25"
        keepalive-time="5000"
        queue-length="1000000"
        reject-policy="RETRY_ABORT" /&gt;
&lt;/managed-executor-services&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Inject point delle applicazioni</p></li></ol></div></div></section>
<section id="_managed_scheduled_executor_services"><h2>Managed Scheduled Executor Services</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;managed-scheduled-executor-services&gt;
    &lt;managed-scheduled-executor-service
        name="default"
        jndi-name="java:jboss/ee/concurrency/scheduler/default"  <b>(1)</b>
        context-service="default"
        thread-factory="default"
        hung-task-threshold="60000"
        core-threads="5"
        keepalive-time="5000"
        reject-policy="RETRY_ABORT" /&gt;
&lt;/managed-scheduled-executor-services&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Inject point delle applicazioni</p></li></ol></div></div></section>
<section id="_default_bindings_12"><h2>Default bindings (1/2)</h2><div class="slide-content"><div class="paragraph"><p>Le specifiche Jakarta EE richiedono alcuni bindings di default:</p></div>
<div class="ulist small"><ul><li><p>Datasource</p></li><li><p>Context Service</p></li><li><p>JMS Connection Factory</p></li><li><p>Managed Executor Service</p></li><li><p>Managed Scheduled Executor Service</p></li><li><p>Managed Thread Factory</p></li></ul></div></div></section>
<section id="_default_bindings_22"><h2>Default bindings (2/2)</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">  &lt;default-bindings
 context-service="java:jboss/ee/concurrency/context/default"
 datasource="java:jboss/datasources/ExampleDS"
 jms-connection-factory="java:jboss/DefaultJMSConnectionFactory"
 managed-executor-service="java:jboss/ee/concurrency/executor/default"
 managed-scheduled-executor-service="java:jboss/ee/concurrency/scheduler/default"
 managed-thread-factory="java:jboss/ee/concurrency/factory/default" /&gt;</code></pre></div></div></div></section>
<section id="_naming_subsystem_12"><h2>Naming subsystem (1/2)</h2><div class="slide-content"><div class="paragraph"><p>JNDI è un&#8217;API Java per un servizio di directory che consente ai client Java di scoprire e cercare dati e oggetti tramite nome.</p></div>
<div class="paragraph"><p>Per includere dei bindings predefiniti, si utilizza il <code>naming</code> subsystem:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:naming:2.0"&gt;
   &lt;bindings&gt;
      &lt;simple name="java:/jndi/mykey" value="MyValue"/&gt;
   &lt;/bindings&gt;
   &lt;remote-naming/&gt;
&lt;/subsystem&gt;</code></pre></div></div></div></section>
<section id="_naming_subsystem_22"><h2>Naming subsystem (2/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>E' possibile creare degli alias, per raggiungere oggetti mediante un alias</p></li><li><p>Utile per bindings legacy non più modificabili</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:naming:2.0"&gt;
   &lt;bindings&gt;
      &lt;lookup name="java:global/MyOldEJB"
              lookup="java:global/my-ear/my-ejb-module/ExampleEJB"/&gt;
   &lt;/bindings&gt;
   &lt;remote-naming/&gt;
&lt;/subsystem&gt;</code></pre></div></div></div></section>
<section id="_batch_jberet_subsystem_12"><h2>Batch-jberet subsystem (1/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>La specifica Jakarta Batch è implementata nel subsystem <code>jberet</code></p></li><li><p>Di default i jobs sono memorizzati in memory:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:batch-jberet:2.0"&gt;
   &lt;default-job-repository name="in-memory" /&gt;
   &lt;default-thread-pool name="batch" /&gt;
   &lt;job-repository name="in-memory"&gt;
      &lt;in-memory /&gt;
   &lt;/job-repository&gt;
   &lt;thread-pool name="batch"&gt;
      &lt;max-threads count="10" /&gt;
      &lt;keepalive-time time="30" unit="seconds" /&gt;
   &lt;/thread-pool&gt;
&lt;/subsystem&gt;</code></pre></div></div></div></section>
<section id="_batch_jberet_subsystem_22"><h2>Batch-jberet subsystem (2/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Per scenari di HA è possibile scegliere la persistenza dei jobs nel DB:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=batch-jberet/jdbc-job-repository=jdbc-repository:add(data-source=PostgrePool)

/subsystem=batch-jberet:write-attribute(name=default-job-repository,value=jdbc-repository)</code></pre></div></div></div></section>
<section id="_mail_subsystem"><h2>Mail subsystem</h2><div class="slide-content"><div class="ulist"><ul><li><p>La specifica Jakarta Mail consente di fornire una sessione di Mail alle applicazioni:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:mail:4.0"&gt;
                &lt;mail-session name="default" jndi-name="java:jboss/mail/Default"&gt;
                          &lt;smtp-server outbound-socket-binding-ref="mail-smtp"/&gt; <b>(1)</b>
                &lt;/mail-session&gt;
&lt;/subsystem&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Configura destinazione del server SMTP</p></li></ol></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;outbound-socket-binding name="mail-smtp"&gt;
                &lt;remote-destination host="${jboss.mail.server.host:localhost}" port="${jboss.mail.server.port:25}"/&gt;
&lt;/outbound-socket-binding&gt;</code></pre></div></div></div></section>
<section id="_transaction_subsystem"><h2>Transaction subsystem</h2><div class="slide-content"><div class="ulist"><ul><li><p>La gestione delle transazioni è demandata al Transaction Manager <strong>Narayana</strong>.</p></li><li><p>Componenti principali</p><div class="ulist"><ul><li><p>Core environment</p></li><li><p>Recovery-environment</p></li><li><p>Coordinator-environment</p></li><li><p>Object-store</p></li></ul></div></li></ul></div></div></section>
<section id="_transaction_timeout"><h2>Transaction Timeout</h2><div class="slide-content"><div class="paragraph"><p>Il Timeout delle transazioni è configurabile all&#8217;interno del Transaction Coordinator:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:transactions:6.0"&gt;
    &lt;core-environment node-identifier="${jboss.tx.node.id:1}"&gt;
        &lt;process-id&gt;
            &lt;uuid/&gt;
        &lt;/process-id&gt;
    &lt;/core-environment&gt;
    &lt;recovery-environment socket-binding="txn-recovery-environment" status-socket-binding="txn-status-manager"/&gt;
    &lt;coordinator-environment default-timeout="300" /&gt; <b>(1)</b>
    &lt;object-store path="tx-object-store" relative-to="jboss.server.data.dir"/&gt;
&lt;/subsystem&gt;</code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Timeout transazioni JTA</p></li></ol></div></div></section>
<section id="_capitolo_10_logging_subsystem"><h2>Capitolo 10: Logging subsystem</h2><div class="slide-content"><div class="ulist"><ul><li><p>I logs di WildFly sono scritti nella cartella definita da <code>jboss.server.log.dir</code>.</p></li><li><p>Modificabile all&#8217;avvio con:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> ./standalone.sh -Djboss.server.log.dir=/home/user/logs</code></pre></div></div></div></section>
<section id="_logging_subsystem"><h2>Logging subsystem</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:logging:8.0"&gt;

    &lt;periodic-rotating-file-handler name="FILE" autoflush="true"&gt; <b>(1)</b>
        &lt;formatter&gt;
            &lt;named-formatter name="PATTERN"/&gt;
        &lt;/formatter&gt;
        &lt;file relative-to="jboss.server.log.dir" path="server.log"/&gt;
        &lt;suffix value=".yyyy-MM-dd"/&gt;
        &lt;append value="true"/&gt;
    &lt;/periodic-rotating-file-handler&gt;
    &lt;logger category="com.arjuna"&gt; <b>(2)</b>
        &lt;level name="WARN"/&gt;
    &lt;/logger&gt;

    &lt;root-logger&gt; <b>(3)</b>
        &lt;level name="INFO"/&gt;
        &lt;handlers&gt; <b>(4)</b>
            &lt;handler name="CONSOLE"/&gt;
            &lt;handler name="FILE"/&gt;
        &lt;/handlers&gt;
    &lt;/root-logger&gt;
    &lt;formatter name="PATTERN"&gt; <b>(5)</b>
        &lt;pattern-formatter pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"/&gt;
    &lt;/formatter&gt;
&lt;/subsystem&gt;</code></pre></div></div>
<div class="colist arabic extrasmall"><ol><li><p>A Periodic Rotating File Handler</p></li><li><p>A Custom Logger</p></li><li><p>The Root Logger</p></li><li><p>Handler used by the Logger</p></li><li><p>Formatter</p></li></ol></div></div></section>
<section id="_log_handlers"><h2>Log Handlers</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un Handler intercetta un evento di log e lo esporta ad una destinazione.</p></li><li><p>Categorie disponibili di Handlers:</p><div class="ulist extrasmall"><ul><li><p>**Console Handler: traccia i logs su Console (Default)</p></li><li><p>**File: traccia i logs su File</p></li><li><p>**Periodic: traccia i logs su File ruotandoli su base temporale (Default)</p></li><li><p>Size: traccia i logs su File ruotandoli su dimensione</p></li><li><p>Periodic / Size: traccia i logs su File ruotandoli su base temporale e dimensione</p></li><li><p>Async: Aggiunge ad un Handler la gestione asincrona dei log</p></li><li><p>Custom: Handler custom che estende <code>java.util.logging.Handler</code></p></li><li><p>SysLog handler: Handler basato sul servizio SysLog</p></li></ul></div></li></ul></div></div></section>
<section id="_rotazione_file"><h2>Rotazione File</h2><div class="slide-content"><div class="paragraph"><p>Come effettua la rotazione il Rotating File Handler</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=logging/periodic-rotating-file-handler=FILE/:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "append" =&gt; true,
        "autoflush" =&gt; true,
        "enabled" =&gt; true,
        "encoding" =&gt; undefined,
        "file" =&gt; {
            "relative-to" =&gt; "jboss.server.log.dir",
            "path" =&gt; "server.log"
        },
        "filter" =&gt; undefined,
        "filter-spec" =&gt; undefined,
        "formatter" =&gt; "%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n",
        "level" =&gt; "ALL",
        "name" =&gt; "FILE",
        "named-formatter" =&gt; "PATTERN",
        "suffix" =&gt; ".yyyy-MM-dd" <b>(1)</b>
    }
}</code></pre></div></div>
<div class="colist arabic extrasmall"><ol><li><p>Rotazione su base giornaliera</p></li></ol></div></div></section>
<section id="_creazione_di_un_size_handler"><h2>Creazione di un Size Handler</h2><div class="slide-content"><div class="paragraph"><p>Esempio: come definire un Size Handler che faccia una rotazione ogni 2 MB del file di log:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem="logging"/size-rotating-file-handler="SIZEHANDLER":add(append="true",autoflush="true",file={"relative-to"=&gt; "jboss.server.log.dir","path" =&gt;"largelog.log"},max-backup-index=1,rotate-on-boot=true,rotate-size=2m)</code></pre></div></div>
<div class="imageblock"><img src="images/size-handler.png" alt="size handler"></div></div></section>
<section id="_loggers"><h2>Loggers</h2><div class="slide-content"><div class="paragraph"><p>Collegano gli Handler ad un namespace applicativo:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;periodic-rotating-file-handler name="fileHandler"&gt;
    &lt;level name="TRACE"/&gt;
    ...
&lt;/periodic-rotating-file-handler&gt;"

&lt;logger category="com.acme"&gt;
    &lt;level name="INFO"/&gt;
    &lt;handlers&gt;
        &lt;handler name="fileHandler"/&gt; <b>(1)</b>
    &lt;/handlers&gt;
&lt;/logger&gt;</code></pre></div></div>
<div class="colist arabic extrasmall"><ol><li><p>Prevale il livello <strong>meno</strong> verboso</p></li></ol></div></div></section>
<section id="_root_logger"><h2>Root Logger</h2><div class="slide-content"><div class="ulist"><ul><li><p>E' il padre di tutti i Loggers</p></li><li><p>Tutti le classi che non sono collegate ad un Logger, utilizzano il Root Logger</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=logging/root-logger=ROOT/:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "filter" =&gt; undefined,
        "filter-spec" =&gt; undefined,
        "handlers" =&gt; [
            "CONSOLE",
            "FILE"
        ],
        "level" =&gt; "INFO"   }
}</code></pre></div></div></div></section>
<section id="_formatters"><h2>Formatters</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consentono di modificare l&#8217;aspetto della stampa dei logs:</p></li><li><p>Utilizza la sintassi definita nella Classe <code>java.util.logging.Formatter</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;formatter name="PATTERN"&gt;
    &lt;pattern-formatter pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"/&gt;
&lt;/formatter&gt;</code></pre></div></div></div></section>
<section id="_definizione_di_filtri"><h2>Definizione di Filtri</h2><div class="slide-content"><div class="paragraph"><p>Oltre che in base alla verbosità, è possibile definire dei filtri sul contenuto dei logs. Esempi:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml"># Esclude linee che contengono IJ000906
/subsystem=logging/periodic-rotating-file-handler=FILE/:write-attribute(name=filter-spec,value=not(match("IJ000906")))

# Include linee che contengono JBAS000001, JBAS000002, JBAS000003
/subsystem=logging/periodic-rotating-file-handler=FILE:write-attribute(name=filter-spec,value=match("JBAS000001|JBAS000002|JBAS000003"))</code></pre></div></div></div></section>
<section id="_logger_profiles"><h2>Logger Profiles</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consentono di definire una configurazione di Log application-scoped</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">  &lt;logging-profiles&gt;
    &lt;logging-profile name="myapp1"&gt;
        &lt;size-rotating-file-handler name="SIZE" autoflush="true"&gt;
                &lt;level name="INFO"/&gt;
                &lt;file relative-to="jboss.server.log.dir" path="mylog.log"/&gt;
                &lt;append value="true"/&gt;
        &lt;/size-rotating-file-handler&gt;
        &lt;logger category="com.mycompany" use-parent-handlers="false"&gt;
            &lt;level name="INFO"/&gt;
            &lt;handlers&gt;
                &lt;handler name="SIZE"/&gt;
            &lt;/handlers&gt;
        &lt;/logger&gt;
    &lt;/logging-profile&gt;
  &lt;/logging-profiles&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Attivabile nel Manifest file applicativo</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>Logging-Profile: myapp1</pre></div></div></div></section>
<section id="_log_asincroni"><h2>Log asincroni</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consente di rendere un Handler asincrono nella scrittura dei logs</p></li><li><p>Ideale per applicazioni I/O bound</p></li><li><p>Non consigliato per applicazioni CPU bound</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>/subsystem=logging/async-handler=asynchandler/:add(queue-length=512,level=ALL,overflow-action=BLOCK,subhandlers=["FILE"])</pre></div></div></div></section>
<section id="_altri_modi_di_leggere_logs"><h2>Altri modi di leggere logs</h2><div class="slide-content"><div class="ulist"><ul><li><p>Da CLI:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=logging/:read-log-file(name=server.log,lines=10,skip=0)</code></pre></div></div>
<div class="ulist"><ul><li><p>Da HTTP:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>http://localhost:9990/management/subsystem/logging/log-file/server.log?operation=attribute&amp;name=stream&amp;useStreamAsResponse&amp;user=admin&amp;password=Password1!</pre></div></div></div></section>
<section id="_capitolo_11_messaging_configuration"><h2>Capitolo 11: Messaging Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le configurazioni <strong>full</strong> dell&#8217;application server includono un server <strong>Apache ActiveMQ Artemis</strong></p></li><li><p>Il server <strong>Apache ActiveMQ Artemis</strong> si basa sulle specifiche Jakarta Messaging 3.1</p></li><li><p>Il subsystem di riferimento è <strong>messaging-activemq</strong></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ standalone.sh -c standalone-full.xml</code></pre></div></div></div></section>
<section id="_architettura_di_activemq_artemis"><h2>Architettura di ActiveMQ Artemis</h2><div class="slide-content"><div class="paragraph"><p>Architettura Server Artemis:</p></div>
<div class="imageblock"><img src="images/artemis-architecture.png" alt="artemis architecture"></div></div></section>
<section id="_componenti"><h2>Componenti</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un <strong>acceptor</strong> definisce quali tipi di connessioni sono accettate dal server ActiveMQ Artemis</p></li><li><p>Un <strong>connector</strong> definisce come connettersi a un altro server ActiveMQ Artemis</p></li><li><p>Gli Acceptor e i Connettore possono essere:</p><div class="ulist"><ul><li><p><strong>in-vm-connector</strong>: Stessa JVM del server</p></li><li><p><strong>netty-connector</strong>: Client remoto via Netty su TCP</p></li><li><p><strong>http-connector</strong>: Client remoto via HTTP</p></li></ul></div></li></ul></div></div></section>
<section id="_creazione_di_destinations"><h2>Creazione di Destinations</h2><div class="slide-content"><div class="ulist"><ul><li><p>JMS Queue: Coda di messaggi che garantisce la distribuzione di messaggi a un singolo consumatore</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> jms-queue add  --queue-address=jms.queue.DemoQueue --entries=java:/jms/queue/demoQueue</code></pre></div></div>
<div class="ulist"><ul><li><p>JMS Topic: meccanismo di distribuzione per la pubblicazione di messaggi inviati a più client.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> jms-topic add  --topic-address=jms.topic.DemoTopic --entries=java:/jms/topic/demoTopic</code></pre></div></div></div></section>
<section id="_address_settings"><h2>Address Settings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le JMS Destinations sono configurate tramite gli Address Settings</p></li><li><p>Di default esiste un unica configurazione valida per tutte le destinations (#)</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=messaging-activemq/server=default/address-setting=#/:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "address-full-policy" =&gt; "PAGE",
        "dead-letter-address" =&gt; "jms.queue.DLQ",
        "expiry-address" =&gt; "jms.queue.ExpiryQueue",
        "expiry-delay" =&gt; -1L,
        "last-value-queue" =&gt; false,
        "max-delivery-attempts" =&gt; 10,
        "max-redelivery-delay" =&gt; 0L,
        "max-size-bytes" =&gt; 10485760L,
        "message-counter-history-day-limit" =&gt; 10,
        "page-max-cache-size" =&gt; 5,
        "page-size-bytes" =&gt; 2097152L,
        "redelivery-delay" =&gt; 0L,
        "redelivery-multiplier" =&gt; 1.0,
        "redistribution-delay" =&gt; -1L,
        "send-to-dla-on-no-route" =&gt; false,
. . . .
    },
}</code></pre></div></div></div></section>
<section id="_configurazione_persistenza"><h2>Configurazione Persistenza</h2><div class="slide-content"><div class="ulist"><ul><li><p>La persistenza dei messaggi può essere in memoria, su disco o su Database</p></li><li><p>Di default è su disco nel journal di Artemis:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=messaging-activemq/server=default:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
. . . .
        "create-journal-dir" =&gt; true,
. . . .
        "journal-buffer-size" =&gt; undefined,
        "journal-buffer-timeout" =&gt; undefined,
        "journal-compact-min-files" =&gt; 10,
        "journal-compact-percentage" =&gt; 30,
        "journal-file-size" =&gt; 102400L,
        "journal-max-io" =&gt; undefined,
        "journal-min-files" =&gt; 2,
        "journal-sync-non-transactional" =&gt; true,
        "journal-sync-transactional" =&gt; true,
        "journal-type" =&gt; "ASYNCIO",
. . . .
        "persist-delivery-count-before-delivery" =&gt; false,
        "persist-id-cache" =&gt; true,
        "persistence-enabled" =&gt; true, <b>(1)</b>
. . . .
}</code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Se impostato a <strong>false</strong> la persistenza è in memoria</p></li></ol></div></div></section>
<section id="_journal_control"><h2>Journal control</h2><div class="slide-content"><div class="ulist"><ul><li><p>Impostare limite massimo su disco del journal</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=messaging-activemq/server=default:write-attribute(name=global-max-disk-usage, value=75)</code></pre></div></div>
<div class="ulist"><ul><li><p>Export journal</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> /subsystem=messaging-activemq/server=default:export-journal()</code></pre></div></div>
<div class="ulist"><ul><li><p>Import Journal</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> /subsystem=messaging-activemq/server=default:import-journal(file=$FILE_PATH/journal-20210507-195651011+0200-dump.xml)</code></pre></div></div></div></section>
<section id="_configurazione_persistenza_su_db"><h2>Configurazione Persistenza su DB</h2><div class="slide-content"><div class="ulist"><ul><li><p>Va definito un datasource da utilizzare</p></li><li><p>E' sufficiente impostare l&#8217;attributo <code>journal-datasource</code>:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=messaging-activemq/server=default:write-attribute(name=journal-datasource,value=PostgrePool)</code></pre></div></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-sql hljs" data-noescape="true" data-lang="sql">postgres=# \dt;
             List of relations
 Schema |      Name      | Type  |  Owner
--------+----------------+-------+----------
 public | bindings       | table | postgres
 public | large_messages | table | postgres
 public | messages       | table | postgres
 public | page_store     | table | postgres</code></pre></div></div></div></section>
<section id="_clustering_jms"><h2>Clustering JMS</h2><div class="slide-content"><div class="ulist"><ul><li><p>Disponibile nel profilo <code>full-ha</code></p></li><li><p>Fornisce ridondanza tra i servers JMS</p></li><li><p>Due modalità:</p><div class="ulist"><ul><li><p>Shared Storage</p></li><li><p>Replication</p></li></ul></div></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Shell Prompt
./standalone.sh -c standalone-full-ha.xml -Djboss.node.name=nodeA

# CLI
/subsystem=messaging-activemq/server=default/:write-attribute(name=cluster-password,value=secretpassword)</code></pre></div></div></div></section>
<section id="_shared_storage"><h2>Shared Storage</h2><div class="slide-content"><div class="paragraph"><p>Più Servers JMS condividono uno Storage Condiviso</p></div>
<div class="imageblock"><img src="images/shared-storage.png" alt="shared storage"></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Master
/subsystem=messaging-activemq/server=default/ha-policy=shared-store-master:add()
# Slave
/subsystem=messaging-activemq/server=default/ha-policy=shared-store-slave:add()</code></pre></div></div></div></section>
<section id="_replication"><h2>Replication</h2><div class="slide-content"><div class="paragraph"><p>Dati sincronizzati tramite network</p></div>
<div class="imageblock"><img src="images/replication.png" alt="replication"></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Master
/subsystem=messaging-activemq/server=default/ha-policy=replication-master:add
# Slave
/subsystem=messaging-activemq/server=default/ha-policy=replication-slave:add</code></pre></div></div></div></section>
<section id="_lab_jms_cluster"><h2>Lab JMS Cluster</h2></section>
<section id="_capitolo_12_wildfly_modules"><h2>Capitolo 12: WildFly Modules</h2><div class="slide-content"><div class="ulist"><ul><li><p>WildFly ha una struttura modulare</p></li><li><p>I moduli di WildFly sono un raggruppamento logico di risorse (classi+configurazione)</p></li><li><p>Da non confondere con i Java Modules (JDK 9)</p></li></ul></div></div></section>
<section id="_categorie_di_moduli"><h2>Categorie di moduli</h2><div class="slide-content"><div class="ulist"><ul><li><p>Statici:</p><div class="ulist"><ul><li><p>Sono risorse installate nella cartella <code>modules</code> usando un namespace corrispondente al percorso.</p></li><li><p>Hanno una configurazion e risorse all&#8217;interno.</p></li><li><p>Richiedono un reload del server per essere lette</p></li></ul></div></li><li><p>Dinamici:</p><div class="ulist"><ul><li><p>Sono risorse caricate a runtime (JAR/WAR/EAR).</p></li><li><p>Non necessitano di configurazione specifica</p></li></ul></div></li></ul></div></div></section>
<section id="_configurazione_dei_moduli_statici"><h2>Configurazione dei moduli statici</h2><div class="slide-content"><div class="ulist"><ul><li><p>I moduli statici vanno installati nel percorso <code>modules</code> di WildFly</p></li><li><p>E' possibile fare override tramite la variabile <code>JBOSS_MODULEPATH</code></p></li></ul></div>
<div class="imageblock"><img src="images/module_path.png" alt="module path"></div></div></section>
<section id="_come_installare_un_nuovo_modulo"><h2>Come installare un nuovo modulo</h2><div class="slide-content"><div class="paragraph"><p>Strategia consigliata per installare un modulo: usare la CLI</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">module add --name=org.jython --resources=/usr/libs/jython-standalone-2.5.2.jar --dependencies=javax.api</code></pre></div></div>
<div class="imageblock"><img src="images/module-sample.png" alt="module sample"></div></div></section>
<section id="_come_utilizzare_un_modulo_installato"><h2>Come utilizzare un modulo installato</h2><div class="slide-content"><div class="ulist"><ul><li><p>Includi nel Manifest file il riferimento al modulo</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>Dependencies: org.jython</pre></div></div>
<div class="ulist"><ul><li><p>Oppure nel file jboss-deployment-structure.xml</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;jboss-deployment-structure&gt;

    &lt;dependencies&gt;
      &lt;module name="org.jython" /&gt;
    &lt;/dependencies&gt;

&lt;jboss-deployment-structure&gt;</code></pre></div></div></div></section>
<section id="_moduli_globali"><h2>Moduli Globali</h2><div class="slide-content"><div class="ulist"><ul><li><p>Nel subsystem <code>ee</code> è possibile specificare quali moduli sono globali, quindi accessibili a tutte le applicazioni</p></li><li><p>Come rendere un modulo Globale:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem="ee":write-attribute(name=global-modules,value=[{name="org.apache.log4j",slot="main"}])</code></pre></div></div>
<div class="ulist"><ul><li><p>Risultato:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:ee:4.0"&gt;
   &lt;global-modules&gt;
       &lt;module name="org.apache.log4j" slot="main"/&gt;
   &lt;/global-modules&gt;</code></pre></div></div></div></section>
<section id="_moduli_dinamici"><h2>Moduli dinamici</h2><div class="slide-content"><div class="ulist"><ul><li><p>Ogni archivio di cui viene fatto il deploy è un modulo</p></li><li><p>Al modulo viene attributito il nome:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>deployment.[archivename]</pre></div></div>
<div class="ulist"><ul><li><p>Esempio per applicazione Web WebExample1.war</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>deployment.WebExample1.war</pre></div></div></div></section>
<section id="_utilizzo_moduli_dinamici"><h2>Utilizzo moduli dinamici</h2><div class="slide-content"><div class="paragraph"><p>Un modulo dinamico si utilizza allo stesso modo di un modulo statico. Esempio:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;jboss-deployment-structure&gt;
  &lt;deployment&gt;
      &lt;dependencies&gt;
         &lt;module name="deployment.itextpdf-5.4.3.jar" export="TRUE"/&gt;
      &lt;/dependencies&gt;
    &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre></div></div></div></section>
<section id="_isolamento_moduli_ear"><h2>Isolamento moduli EAR</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">myapp.ear
 |
 |__web.war <b>(1)</b>
 |
 |__ejb.jar <b>(2)</b>
 |
 |__lib/utility.jar <b>(3)</b></code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Possono referenziare gli EJB nel JAR a meno di non settare <code>ear-subdeployments-isolated</code> a <strong>true</strong></p></li><li><p>Non Possono referenziare le Web Application Classes</p></li><li><p>Visibili ad entrambi i moduli</p></li></ol></div></div></section>
<section id="_capitolo_13_cluster"><h2>Capitolo 13: Cluster</h2><div class="slide-content"><div class="ulist"><ul><li><p>Elementi fondamentali del clustering di WildFly:</p></li></ul></div>
<div class="imageblock"><img src="images/clustering_blocks.png" alt="clustering blocks"></div>
<div class="ulist"><ul><li><p>Avvio in modalità HA:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>$ standalone.sh -c standalone-ha.xml
$ standalone.sh -c standalone-full-ha.xml</pre></div></div></div></section>
<section id="_scenari_possibili_di_clustering_12"><h2>Scenari Possibili di clustering (1/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Clustering orizzontale</p></li></ul></div>
<div class="imageblock"><img src="images/cluster-multihost.png" alt="cluster multihost"></div></div></section>
<section id="_scenari_possibili_di_clustering_22"><h2>Scenari Possibili di clustering (2/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Clustering veriticale</p></li></ul></div>
<div class="imageblock"><img src="images/cluster-vertical.png" alt="cluster vertical"></div></div></section>
<section id="_trasporto_jgroups"><h2>Trasporto JGroups</h2><div class="slide-content"><div class="ulist"><ul><li><p>JGroups è il layer di trasporto dei dati nel cluster</p></li><li><p>Attivato quando un componente cluster-aware è disponibile</p></li></ul></div>
<div class="imageblock"><img src="images/jgroups.png" alt="jgroups"></div></div></section>
<section id="_stack_disponibili_per_clustering" class="columns"><h2>Stack disponibili per clustering</h2><div class="slide-content"><div class="imageblock column"><img src="images/udp.png" alt="udp"></div>
<div class="imageblock column"><img src="images/tcp.png" alt="tcp"></div>
<div class="ulist"><ul><li><p>Default stack: UDP</p></li></ul></div></div></section>
<section id="_modifica_stack_di_default"><h2>Modifica stack di default</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:jgroups:6.0"&gt;
        &lt;channels default="ee"&gt;
            &lt;channel name="ee" stack="udp"/&gt; <b>(1)</b>
        &lt;/channels&gt;
        . . . . . .
&lt;/subsystem&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Stack di default è UDP</p></li></ol></div>
<div class="paragraph"><p>Modifica:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=jgroups/channel=ee:write-attribute(name=stack,value=tcp)</code></pre></div></div></div></section>
<section id="_configurazione_tcp_statico"><h2>Configurazione TCP statico</h2><div class="slide-content"><div class="ulist"><ul><li><p>JGroups:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;stack name="tcpping"&gt;
    &lt;transport type="TCP" socket-binding="jgroups-tcp"/&gt;
    &lt;socket-discovery-protocol type="TCPPING" socket-bindings="jgroups-host-a jgroups-host-b"/&gt;
    &lt;protocol type="MERGE3"/&gt;
    &lt;protocol type="FD_SOCK"/&gt;
    &lt;protocol type="FD_ALL"/&gt;
. . . .
&lt;/stack&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Socket Bindings:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}"&gt;

    &lt;outbound-socket-binding name="jgroups-host-a"&gt;
        &lt;remote-destination host="host1" port="7600"/&gt;
    &lt;/outbound-socket-binding&gt;
    &lt;outbound-socket-binding name="jgroups-host-b"&gt;
        &lt;remote-destination host="host2" port="7600"/&gt;
    &lt;/outbound-socket-binding&gt;
&lt;/socket-binding-group&gt;</code></pre></div></div></div></section>
<section id="_ottimizzazioni_stack_groups"><h2>Ottimizzazioni Stack Groups</h2><div class="slide-content"><div class="ulist"><ul><li><p>Ogni layer di JGroup ha una serie di parametri che sono configurabili</p></li><li><p>Verifica sempre nella documentazione il significato dei singoli parametri: <a href="http://www.jgroups.org/manual/index.html#protlist" class="bare">http://www.jgroups.org/manual/index.html#protlist</a></p></li><li><p>Esempio:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>/subsystem=jgroups/stack=udp/protocol=PING/property=timeout/:add(value=100)</pre></div></div></div></section>
<section id="_configurazione_cache_del_cluster"><h2>Configurazione Cache del cluster</h2><div class="slide-content"><div class="ulist"><ul><li><p>WildFly utilizza <strong>Infinispan</strong> come engine per gestire la Cache del Cluster</p></li><li><p>Utilizzabile in due modalità principali:</p><div class="ulist"><ul><li><p>Distributed Cache: La cache dati viene distribuita ad un numero di owners</p></li><li><p>Replicated Cache: La cache viene replicata a tutti i membri del cluster</p></li><li><p>Invalidation Cache: Utilizzata per invalidare dati nella Cache a fronte di modifiche nello storage</p></li></ul></div></li></ul></div></div></section>
<section id="_replicated_cache"><h2>Replicated Cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>I dati sono replicati su tutti i nodi del cluster</p></li><li><p>Ottimale per cluster prevalentemente in lettura dati</p></li><li><p>Poco scalabile in scrittura all&#8217;aumento dei nodi</p></li></ul></div>
<div class="imageblock"><img src="images/replicated.png" alt="replicated"></div></div></section>
<section id="_distributed_cache"><h2>Distributed Cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>I dati sono replicati su un numero di <code>owners</code></p></li><li><p>Maggiore scalabilità in scrittura ma ridotta HA</p></li></ul></div>
<div class="imageblock"><img src="images/replicated.png" alt="replicated"></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=infinispan/cache-container=ejb/distributed-cache=dist/:write-attribute(name=owners,value=3)</code></pre></div></div></div></section>
<section id="_invalidation_cache"><h2>Invalidation Cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>Garantisce che i nodi del cluster hanno una copia aggiornata dei dati nel DB</p></li><li><p>Utilizzata da Hibernate in scenari di HA per garantire la coerenza dei dati</p></li></ul></div>
<div class="imageblock"><img src="images/invalidation.png" alt="invalidation"></div></div></section>
<section id="_cache_data_expiration_12"><h2>Cache Data expiration (1/2)</h2><div class="slide-content"><div class="paragraph"><p>Utilizzata per rimuovere dati vecchi nella Cache su base temporale</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;distributed-cache name="dist"&gt;
    &lt;locking isolation="REPEATABLE_READ"/&gt;
    &lt;expiration interval="0"/&gt; <b>(1)</b>
&lt;/distributed-cache&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Durate dei dati nella cache. Quando è 0 non ha scadenza</p></li></ol></div></div></section>
<section id="_cache_data_expiration_22"><h2>Cache Data expiration (2/2)</h2><div class="slide-content"><div class="paragraph"><p>Utilizzata per rimuovere dati che sono idle</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;local-cache name="local-query"&gt;
    &lt;heap-memory size="10000"/&gt;
    &lt;expiration max-idle="100000"/&gt; <b>(1)</b>
&lt;/local-cache&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Dati idle rimossi dopo 100000 ms</p></li></ol></div></div></section>
<section id="_locking_isolation"><h2>Locking isolation</h2><div class="slide-content"><div class="paragraph"><p>Configura livello di isolamento per accessi concorrenti ai dati della Cache</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;distributed-cache name="dist"&gt;
    &lt;locking isolation="REPEATABLE_READ"/&gt; <b>(1)</b>
    &lt;expiration interval="0"/&gt;
&lt;/distributed-cache&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Con questo isolation level, quando leggi i dati da una tabella/riga, nessun&#8217;altra transazione può modificarli finché la tua transazione non è completata.</p></li></ol></div></div></section>
<section id="_cache_eviction"><h2>Cache eviction</h2><div class="slide-content"><div class="paragraph"><p>Consente di stabulire un limite massimo (size) all&#8217;uso della Cache.
I dati in cache che eccedono verranno rimossi (eviction)</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;invalidation-cache name="entity"&gt;
    &lt;heap-memory size="10000" size-unit="MB"/&gt; <b>(1)</b>
    &lt;expiration max-idle="100000"/&gt;
&lt;/invalidation-cache&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Eviction dei dati oltre i 10000 MB di Cache</p></li></ol></div></div></section>
<section id="_storage_della_cache"><h2>Storage della Cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>Lo storage della Cache consente di fare offloading dei dati dalla memoria su supporto fisico</p></li><li><p>Utilizzo comune: Passivazione Stateful beans su File</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;distributed-cache name="persistent"&gt;
    &lt;locking isolation="REPEATABLE_READ"/&gt;
    &lt;transaction mode="BATCH"/&gt;
    &lt;expiration interval="0"/&gt;
    &lt;file-store passivation="true"/&gt;
&lt;/distributed-cache&gt;</code></pre></div></div></div></section>
<section id="_cache_storage"><h2>Cache Storage</h2><div class="slide-content"><div class="paragraph"><p>Infinispan offre diverse modalità di Storage dei dati:</p></div>
<div class="ulist"><ul><li><p>file : Cache Store su file</p></li><li><p>custom: Cache Store custom</p></li><li><p>hotrod : Cache Store che utilizza il protocollo HotRod</p></li><li><p>jdbc : Cache Store che memorizza sul DB</p></li><li><p>none: Cache Store disabilitato.</p></li></ul></div></div></section>
<section id="_esempio_storage_su_db"><h2>Esempio storage su DB</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;distributed-cache name="dist"&gt;
    &lt;locking isolation="REPEATABLE_READ"/&gt;
    &lt;transaction mode="BATCH"/&gt;
    &lt;expiration interval="0"/&gt;
    &lt;jdbc-store data-source="PostgrePool" dialect="POSTGRES"&gt;
        &lt;table/&gt;
    &lt;/jdbc-store&gt;
&lt;/distributed-cache&gt;</code></pre></div></div>
<div class="paragraph"><p>Tabelle create sul DB:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-sql hljs" data-noescape="true" data-lang="sql"> Column  |       Type        | Collation | Nullable |
---------+-------------------+-----------+----------+
 id      | character varying |           | not null |
 datum   | bytea             |           | not null |
 version | bigint            |           | not null |
 segment | integer           |           | not null |</code></pre></div></div></div></section>
<section id="_web_application_cache"><h2>Web application cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>Gestita nel subsystem <code>distributable-web</code></p></li><li><p>Granularità: SESSION</p></li><li><p>Affinità con Nodo "owner"</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:distributable-web:3.0" default-session-management="default" default-single-sign-on-management="default"&gt;
    &lt;infinispan-session-management name="default" cache-container="web" granularity="SESSION"&gt;
        &lt;primary-owner-affinity/&gt;
    &lt;/infinispan-session-management&gt;
    &lt;!-- ... --&gt;
&lt;/subsystem&gt;</code></pre></div></div></div></section>
<section id="_http_session_granularity"><h2>HTTP Session Granularity</h2><div class="slide-content"><div class="ulist"><ul><li><p>SESSION: Memorizza tutti gli attributi della Session in una singola Entry della cache</p></li><li><p>ATTRIBUTE: Memorizza ogni attributo della Sessione in una Entry della cache</p></li></ul></div>
<div class="paragraph"><p>SESSION è più costosa in termini di serializzazione ma preserva le referenze tra oggetti della Sessione.</p></div>
<div class="ulist"><ul><li><p>Modifica granularity:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=distributable-web/infinispan-session-management=default/:write-attribute(name=granularity,value=ATTRIBUTE)</code></pre></div></div></div></section>
<section id="_http_session_affinity"><h2>HTTP Session Affinity</h2><div class="slide-content"><div class="ulist"><ul><li><p>Livelli consentiti di Session Affinity:</p><div class="ulist"><ul><li><p><strong>none</strong>: Nessuna affinity</p></li><li><p><strong>local</strong>: Affinity con l&#8217;ultimo server che ha gestito la sessione (sticky session)</p></li><li><p><strong>primary-owner</strong>: Affinity con il primary owner della sessione (Default)</p></li><li><p><strong>ranked</strong>: Affinity con il primo nodo disponibile</p></li></ul></div></li></ul></div></div></section>
<section id="_cluster_application_profiles"><h2>Cluster Application Profiles</h2><div class="slide-content"><div class="paragraph"><p>E' possibile definire un profile custom nel file <code>distributable-web.xml</code></p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;distributable-web xmlns="urn:jboss:distributable-web:1.0"&gt;
  &lt;infinispan-session-management cache-container="web" cache="demo-cache" granularity="ATTRIBUTE"&gt;
            &lt;local-affinity/&gt;
  &lt;/infinispan-session-management&gt;
&lt;/distributable-web&gt;</code></pre></div></div></div></section>
<section id="_max_http_active_sessions"><h2>Max HTTP Active Sessions</h2><div class="slide-content"><div class="ulist"><ul><li><p>Per configurare il numero massimo di sessioni HTTP è possibile usare il file <code>jboss-web.xml</code>:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;jboss-web&gt;
  ...
  &lt;max-active-sessions&gt;1000&lt;/max-active-sessions&gt;
  ...

&lt;/jboss-web&gt;</code></pre></div></div></div></section>
<section id="_ejb_distributable_cache"><h2>EJB Distributable Cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>Configurabile nel subsystem <code>distributable-ejb</code></p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:distributable-ejb:1.0"
       default-bean-management="default"&gt;
    &lt;infinispan-bean-management name="default" cache-container="ejb" <b>(1)</b>
     max-active-beans="10000"  /&gt;  <b>(2)</b>
    &lt;infinispan-client-mappings-registry cache-container="ejb" <b>(3)</b>
    cache="client-mappings"/&gt;

&lt;/subsystem&gt;</code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Cache container di Infinispan</p></li><li><p>Numero massimo si Stateful Beans Attivi</p></li><li><p>Cache EJB Clients</p></li></ol></div></div></section>
<section id="_invalidation_cache_2"><h2>Invalidation Cache</h2><div class="slide-content"><div class="ulist"><ul><li><p>Usata per gestire Cache di dati provenienti dal DB</p></li><li><p>Le modifiche non generano replication dei dati</p></li><li><p>Notifica ai nodi che hanno dati "stale" in Cache</p></li></ul></div>
<div class="imageblock"><img src="images/cache-inv.png" alt="cache inv"></div></div></section>
<section id="_load_balancing"><h2>Load Balancing</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consente di bilanciare le richieste su più nodi del cluster</p></li><li><p>Può essere gestita da WildFly o mediante altri bilanciatori</p></li><li><p>Può essere gestita client-side or server-side</p></li></ul></div></div></section>
<section id="_mod_jk"><h2>mod_jk</h2><div class="slide-content"><div class="ulist"><ul><li><p>Modulo legacy derivante da Apache Tomcat</p></li><li><p>Configurabile in un file esterno</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Esempio mod-jk.conf

worker.list=loadbalancer,status

# Define Node1

worker.node1.port=8009
worker.node1.host=localhost
worker.node1.type=ajp13
worker.node1.lbfactor=1

# Define Node2

worker.node2.port=8159
worker.node2.host=localhost
worker.node2.type=ajp13
worker.node2.lbfactor=1

# Load-balancing behavior

worker.loadbalancer.type=lb
worker.loadbalancer.balance_workers=node1,node2
worker.loadbalancer.sticky_session=1
worker.status.type=status</code></pre></div></div></div></section>
<section id="_configurazione_protocollo_ajp"><h2>Configurazione protocollo AJP</h2><div class="slide-content"><div class="ulist"><ul><li><p>Occorre che sia disponibile un ajp-listener su Undertow</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>/subsystem=undertow/server=default-server/ajp-listener=ajp:add(socket-binding=ajp)</pre></div></div></div></section>
<section id="_configurazione_mod_cluster"><h2>Configurazione mod_cluster</h2><div class="slide-content"><div class="ulist"><ul><li><p>Modulo per eseguire load balancing tra nodi di un cluster WildFly</p></li><li><p>Disponibile come modulo di Apache o come profilo nativo di WildFly</p></li><li><p>Consente di eseguire server-side lb basato su metriche lato server</p></li></ul></div></div></section>
<section id="_wildfly_native_load_balancer_11"><h2>WildFly native Load Balancer (1/1)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Il profilo <strong>loadbalancer</strong> di WildFly consente di utilizzare il Server come load balancer</p></li></ul></div>
<div class="imageblock"><img src="images/balancer.png" alt="balancer"></div></div></section>
<section id="_wildfly_native_load_balancer_22"><h2>WildFly native Load Balancer (2/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Il profilo utilizza mod_cluster come filtro delle richieste HTTP</p></li><li><p>Viene fatto advertising sul binding "modcluster" in multicast</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">   &lt;filters&gt;
        &lt;mod-cluster name="load-balancer" management-socket-binding="mcmp-management"
         advertise-socket-binding="modcluster" enable-http2="true" max-retries="3"&gt;
            &lt;single-affinity/&gt;
        &lt;/mod-cluster&gt;
    &lt;/filters&gt;</code></pre></div></div></div></section>
<section id="_verifica_multicast"><h2>Verifica Multicast</h2><div class="slide-content"><div class="ulist"><ul><li><p>E&#8217;possibile usare le classi di test di JGroups per verificare il multicast:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">java -classpath jgroups-5.2.9.Final.jar org.jgroups.tests.McastReceiverTest -mcast_addr 224.0.1.105 -port 23364</code></pre></div></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">java -classpath jgroups-5.2.9.Final.jar org.jgroups.tests.McastSenderTest -mcast_addr 224.0.1.105 -port 23364</code></pre></div></div></div></section>
<section id="_mod_cluster_statico"><h2>mod_cluster statico</h2><div class="slide-content"><div class="ulist"><ul><li><p>Se multicast non è applicabile, si può configurare una lista statica di servers</p></li><li><p>Lato client va disabilitato il meccanismo l&#8217;advertising</p></li><li><p>Lato server vanno aggiunti i nodi statici</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Server di Front-end
/profile=load-balancer/subsystem=undertow/configuration=filter/mod-cluster=load-balancer:write-attribute(name=advertise-frequency,value=0)

/profile=load-balancer/subsystem=undertow/configuration=filter/mod-cluster=load-balancer:undefine-attribute(name=advertise-socket-binding)</code></pre></div></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Servers di back-end
/socket-binding-group=ha-sockets/remote-destination-outbound-socket-binding=proxy1:add(host=localhost, port=8090)

/profile=ha/subsystem=modcluster/proxy=default:write-attribute(name=proxies,value=[proxy1])</code></pre></div></div></div></section>
<section id="_sticky_sessions"><h2>Sticky Sessions</h2><div class="slide-content"><div class="ulist"><ul><li><p>Gestite tramite l&#8217;attributo sticky-session</p></li><li><p>Di default abilitate</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=modcluster/proxy=default:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "advertise" =&gt; true,
. . . .
        "sticky-session" =&gt; true,
        "sticky-session-force" =&gt; false,
        "sticky-session-remove" =&gt; false,
        "stop-context-timeout" =&gt; 10,
        "ttl" =&gt; undefined,
        "worker-timeout" =&gt; undefined,
        "load-provider" =&gt; {"dynamic" =&gt; undefined}
    }
}</code></pre></div></div></div></section>
<section id="_drain_sessioni_http"><h2>Drain Sessioni HTTP</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consente di terminare gracefully le sessioni esistenti</p></li><li><p>Avviene prima dell' undeploy dell&#8217;applicazione</p><div class="ulist"><ul><li><p><strong>DEFAULT</strong>: Abilitato per applicazioni non-distributable.</p></li><li><p><strong>ALWAYS</strong>: Abilitato sempre (distributable e non distributable).</p></li><li><p><strong>NEVER</strong>: Disabilitato</p></li></ul></div></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=modcluster/proxy=default:write-attribute(name=session-draining-strategy,value=ALWAYS)</code></pre></div></div></div></section>
<section id="_configurazione_delle_metriche"><h2>Configurazione delle metriche</h2><div class="slide-content"><div class="ulist"><ul><li><p>E' possibile definire le metriche da usare per il load balancing:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:modcluster:4.0"&gt;
    &lt;proxy name="default" advertise-socket="modcluster" listener="ajp"&gt;
        &lt;dynamic-load-provider&gt;
            &lt;load-metric type="cpu"/&gt; <b>(1)</b>
        &lt;/dynamic-load-provider&gt;
    &lt;/proxy&gt;
. . .
&lt;/subsystem&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Metrica basata su CPU</p></li></ol></div></div></section>
<section id="_metriche_disponibili"><h2>Metriche disponibili</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>busyness</strong>: Computata sulla base dei Thread di connessione utilizzati</p></li><li><p><strong>cpu</strong>: Computata sulla base della CPU utilizzata</p></li><li><p><strong>heap</strong>: Computata sulla base dell&#8217;Heap size</p></li><li><p><strong>sessions</strong>: Computata sulla base del numero di Sessioni Web</p></li><li><p><strong>requests</strong>: Computata sulla base di requests/sec</p></li><li><p><strong>send-traffic</strong>: Computata sulla base di traffico in uscita</p></li><li><p><strong>receive-traffic</strong>: Computata sulla base di POST in ingresso</p></li></ul></div></div></section>
<section id="_attributi_delle_metriche"><h2>Attributi delle metriche</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>weight</strong> : Peso specifico rispetto ad altre metriche</p></li><li><p><strong>capacity</strong>: A parità di weight viene favorito il nodo con maggiore capacity</p></li></ul></div>
<div class="paragraph"><p>Esempio:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=modcluster/proxy=default/load-provider=dynamic/load-metric=heapmetric/:add(type=heap,weight=1,capacity=1.0)</code></pre></div></div></div></section>
<section id="_capitolo_15_sicurezza_di_wildfly_con_elytron"><h2>Capitolo 15: Sicurezza di WildFly con Elytron</h2><div class="slide-content"><div class="paragraph"><p>WildFly utilizza il framework Elytron per gestire tutti gli aspetti della sicurezza tra cui:</p></div>
<div class="ulist"><ul><li><p>Authentication and Authorization</p></li><li><p>SSL / TLS</p></li><li><p>Secure Credential Storage</p></li></ul></div></div></section>
<section id="_elytron_building_blocks"><h2>Elytron Building Blocks</h2><div class="slide-content"><div class="paragraph"><p><strong>Security Domain</strong>: Contiene tutte le risorse legate alla sicurezza dell&#8217;application server. Include al suo interno:</p></div>
<div class="ulist"><ul><li><p><strong>Security Realm</strong>: Gestiscono l&#8217;accesso ai Repository (es. Database) o Identity store (es. Keycloak) dove sono memorizzate credenziali e permessi.</p></li><li><p><strong>Mapper</strong>: Consente di mappare un Principal con un Realm</p></li><li><p><strong>Authentication Factory</strong>: Contiene policy di autenticazioni per protocolli specifici (es. Kerberos)</p></li></ul></div></div></section>
<section id="_default_security_domain"><h2>Default Security Domain</h2><div class="slide-content"><div class="paragraph"><p>WildFly contiene di default i seguenti Security Domains, entrambi basati su files:</p></div>
<div class="ulist"><ul><li><p><strong>ApplicationDomain</strong>: Utilizzato per mappare Ruoli applicativi</p></li><li><p><strong>ManagementDomain</strong>: Utilizzato per mappare Ruoli Amministrativi del server</p></li></ul></div></div></section>
<section id="_default_security_domain_2"><h2>Default Security Domain</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml"> &lt;security-domains&gt;
	&lt;security-domain name="ApplicationDomain" default-realm="ApplicationRealm" permission-mapper="default-permission-mapper"&gt;
	    &lt;realm name="ApplicationRealm" role-decoder="groups-to-roles"/&gt; <b>(1)</b>
	    &lt;realm name="local"/&gt;
	&lt;/security-domain&gt;
	&lt;security-domain name="ManagementDomain" default-realm="ManagementRealm" permission-mapper="default-permission-mapper"&gt;
	    &lt;realm name="ManagementRealm" role-decoder="groups-to-roles"/&gt;
	    &lt;realm name="local" role-mapper="super-user-mapper"/&gt; <b>(2)</b>
	&lt;/security-domain&gt;
. . . . .
 &lt;/security-domains&gt;</code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Converte attributi di una Identity in Ruoli</p></li><li><p>Mappa Ruoli dopo aver fatto il decode</p></li></ol></div></div></section>
<section id="_built_in_realms"><h2>Built-in Realms</h2><div class="slide-content"><table class="tableblock frame-all grid-all small" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Storage</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">filesystem-realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">File system</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jdbc-realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">key-store-realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Java Keystore</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ldap-realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">LDAP Server</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">properties-realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">File di property</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">token-realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Security Tokens</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">identity-realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">WildFly management model</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">custom-realm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Classe che implementa SecurityRealm/ModifiableSecurityRealm</p></td></tr></table></div></section>
<section id="_lab_configurazione_file_system_realm"><h2>Lab: Configurazione File System Realm</h2><div class="slide-content"><div class="ulist"><ul><li><p>Definisci il Mapper Attributi/Ruoli</p></li><li><p>Crea il File System Realm</p></li><li><p>Registra le Identity con i rispettivi attributi nel Realm</p></li><li><p>Aggiungi il Realm ad un Security Domain</p></li><li><p>Aggiungi il Security Domain alla Factory di Autenticazione</p></li></ul></div></div></section>
<section id="_soluzione"><h2>Soluzione</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">if (outcome != success) of /subsystem=elytron/simple-role-decoder=from-roles-attribute:read-resource
     /subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)
end-if

batch

/subsystem=elytron/filesystem-realm=demoFsRealm:add(path=demofs-realm-users,relative-to=jboss.server.config.dir)

/subsystem=elytron/filesystem-realm=demoFsRealm:add-identity(identity=frank)
/subsystem=elytron/filesystem-realm=demoFsRealm:set-password(identity=frank,clear={password="password123"})
/subsystem=elytron/filesystem-realm=demoFsRealm:add-identity-attribute(identity=frank,name=Roles, value=["Admin","Guest"])

/subsystem=elytron/security-domain=fsSD:add(realms=[{realm=demoFsRealm,role-decoder=from-roles-attribute}],default-realm=demoFsRealm,permission-mapper=default-permission-mapper)

/subsystem=elytron/http-authentication-factory=example-fs-http-auth:add(http-server-mechanism-factory=global,security-domain=fsSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=RealmUsersRoles}]}])

/subsystem=undertow/application-security-domain=httpFsSD:add(http-authentication-factory=example-fs-http-auth)

run-batch</code></pre></div></div></div></section>
<section id="_collegare_il_security_domain_ad_una_applicazione"><h2>Collegare il Security Domain ad una applicazione</h2><div class="slide-content"><div class="ulist"><ul><li><p>Si utilizza il file jboss-web.xml:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;jboss-web&gt;
        &lt;security-domain&gt;httpFsSD&lt;/security-domain&gt;
&lt;/jboss-web&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Oppure si imposta un Security Domain di Default:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=undertow:write-attribute(name=default-security-domain,value="httpFsSD")</code></pre></div></div></div></section>
<section id="_gestione_delle_password"><h2>Gestione delle password</h2><div class="slide-content"><div class="paragraph small"><small>Algoritmi supportati:</small></div>
<div class="ulist"><ul><li><p>bcrypt</p></li><li><p>clear</p></li><li><p>simple-digest</p></li><li><p>salted-simple-digest</p></li><li><p>digest</p></li><li><p>otp</p></li></ul></div>
<div class="paragraph"><p>Esempio: utilizzo algoritmo md5:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=elytron/filesystem-realm=demoFsRealm:set-password(identity=frank,digest={algorithm=digest-md5,password="password123",realm=demoFsRealm})</code></pre></div></div></div></section>
<section id="_crittografia_del_filesystemrealm"><h2>Crittografia del FileSystemRealm</h2><div class="slide-content"><div class="ulist"><ul><li><p>Definisci un Credential Store dove sono i Secrets</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=elytron/filesystem-realm=encFsRealm:add(path=fs-realm,relative-to=jboss.server.config.dir, credential-store=credstore, secret-key=key)</code></pre></div></div>
<div class="ulist"><ul><li><p>Configura un File System Realm</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=elytron/filesystem-realm=encFsRealm:add(path=fs-realm,relative-to=jboss.server.config.dir, credential-store=credstore, secret-key=key)</code></pre></div></div>
<div class="ulist"><ul><li><p>Completa la definizione del File System Realm</p></li></ul></div></div></section>
<section id="_soluzione_2"><h2>Soluzione</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=elytron/secret-key-credential-store=credstore:add(path=secret.cs, relative-to=jboss.server.config.dir, create=true, populate=true)

# Start batching commands
batch

# Configure a filesystem realm with a single identity
/subsystem=elytron/filesystem-realm=encFsRealm:add(path=fs-realm,relative-to=jboss.server.config.dir, credential-store=credstore, secret-key=key)
/subsystem=elytron/filesystem-realm=encFsRealm:add-identity(identity=john)
/subsystem=elytron/filesystem-realm=encFsRealm:set-password(digest={algorithm=digest-md5, realm=encFsRealm, password=password123!}, identity=quickstartUser)
/subsystem=elytron/filesystem-realm=encFsRealm:add-identity-attribute(identity=quickstartUser, name=Roles, value=["Admin", "Guest"])

# Add a simple role decoder
/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)

# Configure a new security domain to use our filesystem realm and role decoder
/subsystem=elytron/security-domain=fsDomain:add(realms=[{realm=encFsRealm, role-decoder=from-roles-attribute}], default-realm=encFsRealm,permission-mapper=default-permission-mapper)

# Add the case security domain mapping in the Undertow subsystem
/subsystem=undertow/application-security-domain=other:write-attribute(name=security-domain, value=fsDomain)

# Run the batch commands
run-batch</code></pre></div></div></div></section>
<section id="_jdbc_realm_12"><h2>JDBC Realm (1/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Crea le tabelle di riferimento sul Database</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sql hljs" data-noescape="true" data-lang="sql">CREATE TABLE USERS(login VARCHAR(64) PRIMARY KEY, password VARCHAR(64), role VARCHAR(64));

INSERT into USERS (login,password,role) values('admin','admin','Admin');</code></pre></div></div></div></section>
<section id="_jdbc_realm_22"><h2>JDBC Realm (2/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Configura il Realm su Elytron:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">if (outcome != success) of /subsystem=elytron/simple-role-decoder=from-roles-attribute:read-resource
/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)
end-if



# Define the JDBC Realm
/subsystem=elytron/jdbc-realm=demoJdbcRealm:add(principal-query=[{sql="SELECT password,role FROM USERS WHERE login=?",data-source=PostgrePool,clear-password-mapper={password-index=1},attribute-mapping=[{index=2,to=groups}]}])

# Define the Security Domain
/subsystem=elytron/security-domain=jdbcSD:add(realms=[{realm=demoJdbcRealm,role-decoder=groups-to-roles}],default-realm=demoJdbcRealm,permission-mapper=default-permission-mapper)

Next, we will create an HTTP Authentication Factory which we will bind to Undertow:

/subsystem=elytron/http-authentication-factory=db-http-auth:add(http-server-mechanism-factory=global,security-domain=jdbcSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=RealmUsersRoles}]}])

#Configure Undertow to use this Authentication Factory
/subsystem=undertow/application-security-domain=httpJdbcSD:add(http-authentication-factory=db-http-auth)</code></pre></div></div></div></section>
<section id="_ldap_realm_12"><h2>LDAP Realm (1/2)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Popola il Server LDAP con le Identity:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ldapadd -f example.ldif -x -h localhost -p 389 -D "cn=admin,dc=wildfly,dc=org" -w "admin" -c</code></pre></div></div></div></section>
<section id="_ldap_realm_22"><h2>LDAP Realm (2/2)</h2><div class="slide-content"><div class="paragraph"><p>Configura il Realm su Elytron:</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">if (outcome != success) of /subsystem=elytron/simple-role-decoder=from-roles-attribute:read-resource
/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)
end-if


/subsystem=elytron/dir-context=exampleDC:add(url="ldap://localhost:389",principal="cn=admin,dc=wildfly,dc=org",credential-reference={clear-text="admin"})



/subsystem=elytron/ldap-realm=demoLdapRealm:add(dir-context=exampleDC,identity-mapping={search-base-dn="ou=Users,dc=wildfly,dc=org",rdn-identifier="uid",user-password-mapper={from="userPassword"},attribute-mapping=[{filter-base-dn="ou=Roles,dc=wildfly,dc=org",filter="(&amp;(objectClass=groupOfNames)(member={1}))",from="cn",to="Roles"}]})


/subsystem=elytron/security-domain=ldapSD:add(realms=[{realm=demoLdapRealm,role-decoder=from-roles-attribute}],default-realm=demoLdapRealm,permission-mapper=default-permission-mapper)



/subsystem=elytron/http-authentication-factory=example-ldap-http-auth:add(http-server-mechanism-factory=global,security-domain=ldapSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=RealmUsersRoles}]}])

/subsystem=undertow/application-security-domain=httpLdapSD:add(http-authentication-factory=example-ldap-http-auth)</code></pre></div></div></div></section>
<section id="_ssl_configuration"><h2>SSL Configuration</h2><div class="slide-content"><div class="paragraph"><p>Obiettivi:</p></div>
<div class="ulist"><ul><li><p><strong>Crittografia dei dati</strong>: Impedisce a terzi non autorizzati di intercettare e leggere le informazioni trasmesse.</p></li><li><p><strong>Autenticazione</strong>: Consente di autenticare dimostrando la sua identità tramite l&#8217;uso di certificati digitali.</p></li><li><p><strong>Integrità dei dati</strong>: SSL fornisce un controllo sull&#8217;integrità dei dati scambiati.</p></li></ul></div></div></section>
<section id="_strumenti_principali_per_crittografare"><h2>Strumenti principali per crittografare</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>KeyStore</strong>: Fornito dalle implementazioni standard in Java includono JKS (Java KeyStore) e PKCS#12.</p></li><li><p><strong>OpenSSL</strong>: Toolkit di crittografia open source utilizzabile da linea di comando.</p></li></ul></div></div></section>
<section id="_one_way_ssl_server_authentication"><h2>One-Way SSL (Server Authentication)</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Scopo</strong>: Autenticare il server al client.</p></li><li><p><strong>Processo</strong>: Il server presenta un certificato al client, che il client verifica con le autorità di certificazione (CA).</p></li><li><p><strong>Risultato</strong>: Il client autentica il server e stabilisce una connessione crittografata.</p></li></ul></div>
<div class="imageblock"><img src="images/onewayssl.png" alt="onewayssl"></div></div></section>
<section id="_two_way_ssl_mutual_authentication"><h2>Two-Way SSL (Mutual Authentication)</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Scopo</strong>: Autenticare sia il server che il client.</p></li><li><p><strong>Processo</strong>: Sia Client che Server presentano i propri certificati.</p></li><li><p><strong>Risultato</strong>: Il server verifica il certificato del client e, se valido, si autentica a sua volta, stabilendo una connessione SSL bidirezionale.</p></li></ul></div>
<div class="imageblock"><img src="images/twowayssl.png" alt="twowayssl"></div></div></section>
<section id="_configurazione_ssl"><h2>Configurazione SSL</h2><div class="slide-content"><div class="ulist"><ul><li><p>Metodo più rapido:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[standalone@localhost:9990 /] security enable-ssl-http-server --interactive --override-ssl-context</code></pre></div></div>
<div class="ulist"><ul><li><p>Consente di creare un keystore e configurarlo</p></li></ul></div></div></section>
<section id="_tls_configuration"><h2>TLS Configuration</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml"> &lt;tls&gt;
    &lt;key-stores&gt;
       . . .
        &lt;key-store name="key-store-9fd8cd04-d4c2-4b14-a721-49eed4d1ad97"&gt;
            &lt;credential-reference clear-text="secret"/&gt;
            &lt;implementation type="JKS"/&gt;
            &lt;file required="false" path="wildfly.keystore" relative-to="jboss.server.config.dir"/&gt;
        &lt;/key-store&gt;
    &lt;/key-stores&gt;
    &lt;key-managers&gt;
        &lt;key-manager name="key-manager-9fd8cd04-d4c2-4b14-a721-49eed4d1ad97" key-store="key-store-9fd8cd04-d4c2-4b14-a721-49eed4d1ad97"&gt;
            &lt;credential-reference clear-text="secret"/&gt;
        &lt;/key-manager&gt;
    &lt;/key-managers&gt;
    &lt;server-ssl-contexts&gt;
        &lt;server-ssl-context name="ssl-context-9fd8cd04-d4c2-4b14-a721-49eed4d1ad97" cipher-suite-filter="DEFAULT" protocols="TLSv1.2" want-client-auth="false" need-client-auth="false" authentication-optional="false" use-cipher-suites-order="false" key-manager="key-manager-9fd8cd04-d4c2-4b14-a721-49eed4d1ad97"/&gt;
    &lt;/server-ssl-contexts&gt;
 &lt;/tls&gt;</code></pre></div></div></div></section>
<section id="_configurazione_undertow"><h2>Configurazione Undertow</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml"> &lt;https-listener name="https" socket-binding="https" ssl-context="ssl-context-9fd8cd04-d4c2-4b14-a721-49eed4d1ad97" enable-http2="true"/&gt;</code></pre></div></div></div></section>
<section id="_ssl_management_interfaces"><h2>SSL Management Interfaces</h2><div class="slide-content"><div class="ulist"><ul><li><p>E' possibile cifrare il traffico delle connessioni utilizzate per le interfacce di management</p></li><li><p>Strumenti analoghi a quelli utilizzati per connessioni applicative</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">security enable-ssl-management --interactive</code></pre></div></div></div></section>
<section id="_tls_management_interfaces"><h2>TLS Management Interfaces</h2><div class="slide-content"><div class="ulist"><ul><li><p>A differenza della cifratura di traffico applicativo, <code>ssl-context</code> viene aggiunto nella <code>http-interface</code>:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml"> &lt;management-interfaces&gt;
            &lt;http-interface ssl-context="ssl-context-eb0e29ad-6cf6-4c28-aab2-ffba55eb1d86" security-realm="ManagementRealm"&gt;
                &lt;http-upgrade enabled="true"/&gt;
                &lt;socket-binding http="management-http" https="management-https"/&gt;
            &lt;/http-interface&gt;
 &lt;/management-interfaces&gt;</code></pre></div></div>
<div class="imageblock"><img src="images/ssl-management.png" alt="ssl management"></div></div></section>
<section id="_credential_stores"><h2>Credential Stores</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consentono di memorizzare credenziali in uno store dedicato</p></li><li><p>Sostituiscono il precedente Vault</p></li><li><p>Gestibili sia dal tool `elytron-tool.sh' che dalla CLI</p></li></ul></div></div></section>
<section id="_tipologie_di_credential_stores"><h2>Tipologie di Credential Stores</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>KeyStoreCredentialStore</strong>: Implementazione che utilizza un KeyStore per la cifratura.</p></li><li><p><strong>PropertiesCredentialStore</strong>: Utilizza un file di Property per la cifratura.</p></li></ul></div></div></section>
<section id="_keystorecredentialstore"><h2>KeyStoreCredentialStore</h2><div class="slide-content"><div class="ulist"><ul><li><p>Creazione del Credential Store (default KeyStoreCredentialStore)</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ bin/elytron-tool.sh credential-store --create --location=standalone/configuration/mycredstore.cs</code></pre></div></div>
<div class="ulist"><ul><li><p>Aggiunta di un alias:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=elytron/credential-store=mycredstore:add(path=mycredstore.cs, relative-to=jboss.server.config.dir, credential-reference={clear-text=StorePassword})</code></pre></div></div></div></section>
<section id="_propertiescredentialstore"><h2>PropertiesCredentialStore</h2><div class="slide-content"><div class="ulist"><ul><li><p>Creazione del Credential Store</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ bin/elytron-tool.sh credential-store --create --location=standalone/configuration/propcredstore.cs --type PropertiesCredentialStore</code></pre></div></div>
<div class="ulist"><ul><li><p>Aggiunta di un alias:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=elytron/secret-key-credential-store=mycredstore:add(path=propcredstore.cs, relative-to=jboss.server.config.dir, create=false, populate=false)</code></pre></div></div></div></section>
<section id="_lab_offuscare_la_password_del_datasource"><h2>Lab: Offuscare la password del Datasource</h2><div class="slide-content"><div class="ulist"><ul><li><p>Creazione Credential Store</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">subsystem=elytron/credential-store=my_store:add(location="credentials/csstore.jceks", relative-to=jboss.server.data.dir,  credential-reference={clear-text=mypassword},create=true)</code></pre></div></div>
<div class="ulist"><ul><li><p>Aggiunta dell&#8217;alias:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/subsystem=elytron/credential-store=my_store:add-alias(alias=database-pw, secret-value="postgres")</code></pre></div></div>
<div class="ulist"><ul><li><p>Utilizzo dell&#8217;alias nel DataSource:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">data-source add --jndi-name=java:/PostGreDSSec --name=PostgrePoolSec --connection-url=jdbc:postgresql://localhost/postgres --driver-name=postgres --user-name=postgres --credential-reference={store=my_store, alias=database-pw}</code></pre></div></div></div></section>
<section id="_capitolo_17_rbac_e_altri_vincoli"><h2>Capitolo 17: RBAC e altri vincoli</h2><div class="slide-content"><div class="ulist"><ul><li><p>Di default gli utenti amministrativi sono SuperUser</p></li><li><p>Configurando RBAC è possibile definire i permessi in modo granulare</p><div class="ulist"><ul><li><p>A livello di funzionalità</p></li><li><p>A livello di Host</p></li><li><p>A livello di Gruppo</p></li></ul></div></li></ul></div></div></section>
<section id="_ruoli_predefiniti"><h2>Ruoli Predefiniti</h2><div class="slide-content"><table class="tableblock frame-all grid-all small" style="width:100%"><colgroup><col style="width:23.0769%"><col style="width:76.9231%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Role</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Monitor</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Visualizzano la Configurazione</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Operator</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Monitor</code> + Start/Stop dei server o risorse (es. JMS destinations).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Deployer</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Operator</code> + Deploy applicazioni</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Maintainer</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Deployer</code> + Visualizzazione e modifica Risorse non classificate come critiche.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administrator</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Accesso completo ad esclusione dei sistemi di Auditing.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Auditor</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Accesso e modifica risorse non critiche. Modifiche sistemi di Auditing.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SuperUser</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Tutti i permessi.</p></td></tr></table></div></section>
<section id="_configurazione_di_default"><h2>Configurazione di default</h2><div class="slide-content"><div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;management&gt;
     &lt;access-control provider="simple"&gt; <b>(1)</b>
         &lt;role-mapping&gt;
               &lt;role name="SuperUser"&gt;  <b>(2)</b>
                    &lt;include&gt;
                        &lt;user name="$local"/&gt;
                    &lt;/include&gt;
                &lt;/role&gt;
         &lt;/role-mapping&gt;
     &lt;/access-control&gt;
&lt;/management&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Modello di default senza RBAC</p></li><li><p>ruolo di default</p></li></ol></div></div></section>
<section id="_abilitare_rbac"><h2>Abilitare RBAC</h2><div class="slide-content"><div class="ulist"><ul><li><p>Tramite CLI:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/core-service=management/access=authorization/:write-attribute(name=provider,value=rbac)</code></pre></div></div>
<div class="ulist"><ul><li><p>Esito:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;access-control provider="rbac"&gt;</code></pre></div></div></div></section>
<section id="_lab_creazione_utente_deployer_13"><h2>Lab: Creazione utente Deployer (1/3)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Creazione utente</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">./add-user.sh -m -u wilddeployer -p password1!</code></pre></div></div>
<div class="ulist"><ul><li><p>Abilita RBAC</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/core-service=management/access=authorization/:write-attribute(name=provider,value=rbac)</code></pre></div></div></div></section>
<section id="_lab_creazione_utente_deployer_23"><h2>Lab: Creazione utente Deployer (2/3)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Aggiunta Ruolo</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/core-service=management/access=authorization/role-mapping=Deployer/:add</code></pre></div></div>
<div class="ulist"><ul><li><p>Aggiunta Utente</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/core-service=management/access=authorization/role-mapping=Deployer/include=wilddeployer/:add(type=USER,name=wilddeployer)</code></pre></div></div></div></section>
<section id="_lab_creazione_utente_deployer_33"><h2>Lab: Creazione utente Deployer (3/3)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Verifica configurazione</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-noescape="true" data-lang="xml">&lt;access-control provider="rbac"&gt;
    &lt;role-mapping&gt;
        &lt;role name="SuperUser"&gt;
            &lt;include&gt;
                &lt;user name="$local"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
        &lt;role name="Deployer"&gt;
            &lt;include&gt;
                &lt;user alias="wilddeployer" name="wilddeployer"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
    &lt;/role-mapping&gt;
&lt;/access-control&gt;</code></pre></div></div></div></section>
<section id="_lab_accesso_nel_ruolo_32"><h2>Lab: Accesso nel Ruolo (3/2)</h2><div class="slide-content"><div class="imageblock"><img src="images/rbac1.png" alt="rbac1"></div>
<div class="imageblock"><img src="images/rbac2.png" alt="rbac2"></div></div></section>
<section id="_rbac_modalità_domain"><h2>RBAC modalità domain</h2><div class="slide-content"><div class="paragraph"><p>In modalità dominio è possibile definire i Ruoli in modo granulare:</p></div>
<div class="ulist"><ul><li><p><strong>Host-scoped roles</strong> : Policy di RBAC definita in base all&#8217;Host di Dominio</p></li><li><p><strong>Server-Group-scoped roles</strong>: Policy di RBAC definita in base al Server Group</p></li><li><p>In entrambi i casi, va prima attivat RBAC come per la modalità standalone:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/core-service=management/access=authorization/:write-attribute(name=provider,value=rbac)</code></pre></div></div></div></section>
<section id="_host_scoped_rbac" class="columns"><h2>Host-scoped RBAC</h2><div class="slide-content"><div class="imageblock column"><img src="images/hostscope1.png" alt="hostscope1"></div>
<div class="imageblock column"><img src="images/hostscope2.png" alt="hostscope2"></div></div></section>
<section id="_server_scoped_rbac_12"><h2>Server-scoped RBAC (1/2)</h2><div class="slide-content"><div class="imageblock"><img src="images/sgscope1.png" alt="sgscope1"></div>
<div class="imageblock"><img src="images/sgscope2.png" alt="sgscope2"></div></div></section>
<section id="_server_scoped_rbac_22"><h2>Server-scoped RBAC (2/2)</h2><div class="slide-content"><div class="imageblock"><img src="images/sgscope3.png" alt="sgscope3"></div>
<div class="imageblock"><img src="images/sgscope4.png" alt="sgscope4"></div></div></section>
<section id="_capitolo_18_wildfly_and_docker"><h2>Capitolo 18: WildFly and Docker</h2><div class="slide-content"><div class="ulist"><ul><li><p>Docker è una piattaforma di containerizzazione che consente di isolare e distribuire applicazioni in contenitori leggeri</p></li><li><p>I container Docker includono tutto ciò che è necessario per eseguire un&#8217;applicazione, garantendo portabilità e coerenza tra ambienti.</p></li></ul></div></div></section>
<section id="_docker_vs_virtual_machine"><h2>Docker vs Virtual Machine</h2><div class="slide-content"><div class="imageblock"><img src="images/dockercontainer.png" alt="dockercontainer"></div></div></section>
<section id="_immagine_docker_di_wildfly"><h2>Immagine Docker di WildFly</h2><div class="slide-content"><div class="paragraph"><p>L&#8217;immagine ufficiale di WildFly è disponibile su quay.io</p></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker pull quay.io/wildfly/wildfly:latest</code></pre></div></div>
<div class="ulist"><ul><li><p>Verifica immagine:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker images
REPOSITORY                        TAG             IMAGE ID       CREATED         SIZE
quay.io/wildfly/wildfly           latest          832621dbec56   5 days ago      869MB</code></pre></div></div></div></section>
<section id="_esecuzione_wildfly_con_docker"><h2>Esecuzione WildFly con Docker</h2><div class="slide-content"><div class="ulist"><ul><li><p>Il comando <code>docker run</code> consente di eseguire un Immagine disponibile nel Repository:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run -it -p 8080:8080 quay.io/wildfly/wildfly <b>(1)</b></code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Connessione interattiva (i) tramite terminale(t) con port forward di 8080 su 8080</p></li></ol></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker inspect -f '{{ .NetworkSettings.IPAddress }}' acd9667740ed
172.17.0.2</code></pre></div></div></div></section>
<section id="_estensione_dellimmagine_wildfly"><h2>Estensione dell&#8217;immagine WildFly</h2><div class="slide-content"><div class="ulist"><ul><li><p>Mediante un Dockerfile è possibile estendere un&#8217;immagine:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">FROM quay.io/wildfly/wildfly <b>(1)</b>

RUN /opt/jboss/wildfly/bin/add-user.sh -m -u admin -p Password1! --silent <b>(2)</b>

CMD ["/opt/jboss/wildfly/bin/standalone.sh", "-b", "0.0.0.0", "-bmanagement", "0.0.0.0"] <b>(3)</b></code></pre></div></div>
<div class="colist arabic small"><ol><li><p>Immagine di partenza</p></li><li><p>Esegue un comando durante la fase di costruzione dell&#8217;immagine</p></li><li><p>Comando di default che verrà eseguito quando il Container viene avviato</p></li></ol></div></div></section>
<section id="_build_e_run_di_immagine_custom"><h2>Build e Run di Immagine custom</h2><div class="slide-content"><div class="ulist"><ul><li><p>Build Immagine:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker build --tag=wildfly-admin .</code></pre></div></div>
<div class="ulist"><ul><li><p>Verifica Immagini:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker images
REPOSITORY             TAG                 IMAGE ID               CREATED          VIRTUAL SIZE
wildfly-admin          latest              487adbf6b245        10 seconds ago      1.06 GB</code></pre></div></div>
<div class="ulist"><ul><li><p>Esecuzione Immagine:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker run -it -p 9990:9990 wildfly-admin</code></pre></div></div></div></section>
<section id="_lab_container_image_con_applicativo"><h2>Lab Container Image con applicativo</h2><div class="slide-content"><div class="ulist"><ul><li><p>Esempio di Dockerfile che esegue il deploy di un applicativo</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">FROM quay.io/wildfly/wildfly

ADD helloworld.war /opt/jboss/wildfly/standalone/deployments/</code></pre></div></div></div></section>
<section id="_esecuzione_di_comandi_cli_in_cima_allimmagine_wildfly"><h2>Esecuzione di comandi CLI in cima all&#8217;immagine WildFly</h2><div class="slide-content"><div class="ulist"><ul><li><p>Problema: In fase di costruzione dell&#8217;immagine WildFly non è attivo</p></li><li><p>Soluzione: E&#8217;possibile usare la CLI in modalità embedded:</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">embed-server --std-out=echo
/system-property=foo:add(value=HelloWorld)
stop-embedded-server</code></pre></div></div></div></section>
<section id="_lab_avviare_wildfly_con_configurazione_custom_da_cli"><h2>Lab: Avviare WildFly con configurazione custom da CLI</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">FROM quay.io/wildfly/wildfly

COPY config.cli /opt/jboss/wildfly/bin/config.cli

RUN /opt/jboss/wildfly/bin/jboss-cli.sh --file="/opt/jboss/wildfly/bin/config.cli"</code></pre></div></div></div></section></div></div><script src="https://cdn.jsdelivr.net/npm/reveal.js@4.1.2/dist/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'true',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: false,
  // Push each slide change to the browser history. Implies `hash: true`
  history: false,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'https://cdn.jsdelivr.net/npm/reveal.js@4.1.2/plugin/zoom/zoom.js', async: true, callback: function () { Reveal.registerPlugin(RevealZoom) } },
      { src: 'https://cdn.jsdelivr.net/npm/reveal.js@4.1.2/plugin/notes/notes.js', async: true, callback: function () { Reveal.registerPlugin(RevealNotes) } }
  ],
});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(960, 700)
});</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.1.2/plugin/highlight/monokai.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/highlight.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function( reveal ) {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code' ) ).forEach( function( block ) {

        block.parentNode.className = 'code-wrapper';

        // Code can optionally be wrapped in script template to avoid
        // HTML being parsed by the browser (i.e. when you need to
        // include <, > or & in your code).
        let substitute = block.querySelector( 'script[type="text/template"]' );
        if( substitute ) {
          // textContent handles the HTML entity escapes for us
          block.textContent = substitute.innerHTML;
        }

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightElement( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

      // If we're printing to PDF, scroll the code highlights of
      // all blocks in the deck into view at once
      reveal.on( 'pdf-ready', function() {
        [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code[data-line-numbers].current-fragment' ) ).forEach( function( block ) {
          RevealHighlight.scrollHighlightedLineIntoView( block, {}, true );
        } );
      } );
    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightElement( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        var scrollState = { currentBlock: block };

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );

          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

            // Scroll highlights into view as we step through them
            fragmentBlock.addEventListener( 'visible', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock, scrollState ) );
            fragmentBlock.addEventListener( 'hidden', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock.previousSibling, scrollState ) );

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        // Scroll the first highlight into view when the slide
        // becomes visible. Note supported in IE11 since it lacks
        // support for Element.closest.
        var slide = typeof block.closest === 'function' ? block.closest( 'section:not(.stack)' ) : null;
        if( slide ) {
          var scrollFirstHighlightIntoView = function() {
            RevealHighlight.scrollHighlightedLineIntoView( block, scrollState, true );
            slide.removeEventListener( 'visible', scrollFirstHighlightIntoView );
          }
          slide.addEventListener( 'visible', scrollFirstHighlightIntoView );
        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Animates scrolling to the first highlighted line
     * in the given code block.
     */
    scrollHighlightedLineIntoView: function( block, scrollState, skipAnimation ) {

      cancelAnimationFrame( scrollState.animationFrameID );

      // Match the scroll position of the currently visible
      // code block
      if( scrollState.currentBlock ) {
        block.scrollTop = scrollState.currentBlock.scrollTop;
      }

      // Remember the current code block so that we can match
      // its scroll position when showing/hiding fragments
      scrollState.currentBlock = block;

      var highlightBounds = RevealHighlight.getHighlightedLineBounds( block )
      var viewportHeight = block.offsetHeight;

      // Subtract padding from the viewport height
      var blockStyles = getComputedStyle( block );
      viewportHeight -= parseInt( blockStyles.paddingTop ) + parseInt( blockStyles.paddingBottom );

      // Scroll position which centers all highlights
      var startTop = block.scrollTop;
      var targetTop = highlightBounds.top + ( Math.min( highlightBounds.bottom - highlightBounds.top, viewportHeight ) - viewportHeight ) / 2;

      // Account for offsets in position applied to the
      // <table> that holds our lines of code
      var lineTable = block.querySelector( '.hljs-ln' );
      if( lineTable ) targetTop += lineTable.offsetTop - parseInt( blockStyles.paddingTop );

      // Make sure the scroll target is within bounds
      targetTop = Math.max( Math.min( targetTop, block.scrollHeight - viewportHeight ), 0 );

      if( skipAnimation === true || startTop === targetTop ) {
        block.scrollTop = targetTop;
      }
      else {

        // Don't attempt to scroll if there is no overflow
        if( block.scrollHeight <= viewportHeight ) return;

        var time = 0;
        var animate = function() {
          time = Math.min( time + 0.02, 1 );

          // Update our eased scroll position
          block.scrollTop = startTop + ( targetTop - startTop ) * RevealHighlight.easeInOutQuart( time );

          // Keep animating unless we've reached the end
          if( time < 1 ) {
            scrollState.animationFrameID = requestAnimationFrame( animate );
          }
        };

        animate();

      }

    },

    /**
     * The easing function used when scrolling.
     */
    easeInOutQuart: function( t ) {

      // easeInOutQuart
      return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t;

    },

    getHighlightedLineBounds: function( block ) {

      var highlightedLines = block.querySelectorAll( '.highlight-line' );
      if( highlightedLines.length === 0 ) {
        return { top: 0, bottom: 0 };
      }
      else {
        var firstHighlight = highlightedLines[0];
        var lastHighlight = highlightedLines[ highlightedLines.length -1 ];

        return {
          top: firstHighlight.offsetTop,
          bottom: lastHighlight.offsetTop + lastHighlight.offsetHeight
        }
      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.configure({
  ignoreUnescapedHTML: true,
});
hljs.highlightAll();
</script></body></html>